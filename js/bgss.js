'use strict';$.BGSS=function(){const a=String.fromCharCode(34);return{INDEX_STORAGE:"bgss.index",GAME_STORAGE:"bgss.game",storage2state:function(b,d){if("undefined"!==typeof Storage&&(b=localStorage.getItem(b))){b=JSON.parse(b);for(const k in d)"undefined"!==typeof b[k]&&(d[k]=b[k])}},state2storage:function(b,d){"undefined"!==typeof Storage&&(d=Object.assign({},d),delete d.debug,localStorage.setItem(b,JSON.stringify(d)))},language2ui:function(b){document.documentElement.lang=b;$.dom.all("span[lang]",
function(d){$.dom.hidden(d,$.dom.attr(d,"lang")!==b)});$.dom.all("div[lang]",function(d){$.dom.hidden(d,$.dom.attr(d,"lang")!==b)})},enter2move:function(b){if(13===b.which){var d=$.dom.attr(b.target,"data-index");d&&(d=a+(parseInt(d,10)+1)+a,d=document.querySelector("[data-index="+d+"]"))&&(b.preventDefault(),d.focus(),d.select())}},numdec:function(b,d){return b>d?-1:b<d?1:0}}}();
$.BGSS.index=function(){function a(g){e.known=e.known.filter(h=>h!==g)}function b(){let g=!1,h=$.GAMES[e.game].players.min,p=$.GAMES[e.game].players.max;e.players<h?(e.players=h,g=!0):e.players>p&&(e.players=p,g=!0);$.dom.all("select#players option",function(t){let u=parseInt($.dom.attr(t,"value"),10);$.dom.hidden(t,u<h||u>p)});let r=$.dom.get("players");$.dom.disabled(r,h===p);g&&(r.value=e.players,d())}function d(){for(let g=1;7>=g;g++){let h=$.dom.get("player"+g).parentNode.parentNode;$.dom.hidden(h,
g>e.players)}}function k(g){e.language=g.target.value;$.BGSS.language2ui(e.language);$.BGSS.state2storage($.BGSS.INDEX_STORAGE,e)}function m(g,h){e.game=g.target.value;for(const p of f)p!==h&&($.dom.get("game-"+p).value=e.game);b();$.BGSS.state2storage($.BGSS.INDEX_STORAGE,e)}function n(g){e.players=parseInt(g.target.value,10);d();$.BGSS.state2storage($.BGSS.INDEX_STORAGE,e)}function l(g,h){g.target.value=g.target.value.trim();e.names[h-1]=g.target.value;$.BGSS.state2storage($.BGSS.INDEX_STORAGE,
e)}function q(){for(let g=1;7>=g;g++)$.dom.get("player"+g).value=""}function c(){console.log("next",e);var g={};for(var h of e.known)g[h]=1;for(h=1;h<=e.players;h++)e.names[h-1]&&(g[e.names[h-1]]=1);delete g[""];e.known=Object.keys(g);e.known.sort();$.BGSS.state2storage($.BGSS.INDEX_STORAGE,e);"undefined"!==typeof Storage&&localStorage.removeItem($.BGSS.GAME_STORAGE);g=window.location;h=e.game+".html?language="+e.language;h+="&players="+e.players;e.debug&&(h+="&debug=1");let p=[];for(let r=1;r<=e.players;r++)p.push(e.names[r-
1]||"");h+="&names="+p.map(encodeURI).join(",");g.href=h}const f=["en","fr"];var e={debug:!1,game:"00164928",known:[],language:"en",names:[],players:4};return function(){$.BGSS.storage2state($.BGSS.INDEX_STORAGE,e);var g={debug:!1,game:"",language:"",players:0,forget:""};$.param.setup(g);$.param.parse();for(var h in g)if(g=$.param.get(h),"game"!==h||g in $.GAMES)if("language"!==h||f.includes(g))"forget"===h?a(g):g&&(e[h]=g);h=$.dom.get("language");h.value=e.language;$.BGSS.language2ui(e.language);
for(var p of f)h=$.dom.get("game-"+p),h.value=e.game;b();h=$.dom.get("players");h.value=e.players;d();for(p=1;7>=p;p++)e.names[p-1]&&(h=$.dom.get("player"+p),h.value=e.names[p-1]);h=$.dom.get("known");for(var r of e.known)$.dom.append(h,$.dom.create("option",{value:r}));$.BGSS.state2storage($.BGSS.INDEX_STORAGE,e);e.debug&&console.log("state",e);$.dom.on("language","change",k);for(const t of f)$.dom.on("game-"+t,"change",m,t);$.dom.on("players","change",n);for(r=1;7>=r;r++)$.dom.on("player"+r,"change",
l,r),$.dom.on("player"+r,"keydown",$.BGSS.enter2move);$.dom.on("clear","click",q);$.dom.on("next","click",c)}}();
$.BGSS.game=function(){function a(f){f=$.dom.attr(f,"id");if(!f||!/^\w+\d$/.test(f))return null;let e=f.substring(0,f.length-1),g=parseInt(f.charAt(f.length-1),10);return{string:f,name:e,number:g}}function b(){$.BGSS.language2ui(c.language);$.dom.all("#tab-links li",function(f){let e=a(f);e&&"tabl"===e.name&&(e.number<=c.players||$.dom.hide(f))});$.dom.all("#tabcx table tbody tr",function(f){let e=a(f);e&&"srow"===e.name&&(e.number<=c.players||$.dom.hide(f))});for(let f=1;f<=c.players;f++)c.names[f-
1]&&($.dom.text("iname"+f,c.names[f-1]),$.dom.text("sname"+f,c.names[f-1]));$.dom.text("date",$.timestamp(new Date));$.dom.all("input",function(f){let e=a(f);if(e&&c.data[e.number]&&"undefined"!==typeof c.data[e.number][e.name]){var g=$.dom.attr(f,"type");"number"===g?f.value=c.data[e.number][e.name]:"checkbox"===g&&(f.checked=c.data[e.number][e.name])}});$.dom.all("select",function(f){let e=a(f);e&&c.data[e.number]&&"undefined"!==typeof c.data[e.number][e.name]&&(f.value=c.data[e.number][e.name])});
$.dom.all("input[type=checkbox].highlander:checked",function(f){k(f)})}function d(f){let e={};$.dom.all("#tabc"+f+" input",function(g){let h=a(g);if(h&&!($.dom.class.test(g,"hidden")||$.dom.class.test(g.parentNode,"hidden")||$.dom.class.test(g.parentNode.parentNode,"hidden"))){var p=$.dom.attr(g,"type");"number"===p?(g=$.dom.attr(g,"min"),e[h.name]=g?parseInt(g,10):0):"checkbox"===p&&(e[h.name]=!1)}});$.dom.all("#tabc"+f+" select",function(g){(g=a(g))&&(e[g.name]=0)});return e}function k(f){let e=
a(f),g=f.checked;$.dom.all("input[type=checkbox][id^="+e.name+"].highlander",function(h){let p=a(h);e.string===p.string||e.name!==p.name||p.number>c.players||(c.data[p.number][p.name]=!1,h.checked=!1,h.disabled=g)})}function m(f){f=f.target;let e=a(f);if(e){var g=$.dom.attr(f,"type");if("number"===g){g=parseInt(f.value,10);var h=$.dom.attr(f,"min");null!=h&&(h=parseInt(h,10),g<h&&(g=h,f.value=g));h=$.dom.attr(f,"max");null!=h&&(h=parseInt(h,10),g>h&&(g=h,f.value=g));c.data[e.number][e.name]=g}else"checkbox"===
g&&($.dom.class.test(f,"highlander")&&k(f),c.data[e.number][e.name]=f.checked);$.BGSS.state2storage($.BGSS.GAME_STORAGE,c)}}function n(f){f=f.target;let e=a(f);e&&(c.data[e.number][e.name]=parseInt(f.value,10),$.BGSS.state2storage($.BGSS.GAME_STORAGE,c))}function l(){let f={};for(let e=0;e<=c.players;e++)$.BGSS[c.game].score(c,e),0!==e&&(f[c.data[e].score]=1);c.debug&&console.log("state",c);$.dom.all(".score",function(e){let g=a(e);g&&(g.number>c.players||$.dom.text(e,c.data[g.number][g.name]))});
$.dom.hidden("tie",Object.keys(f).length===c.players)}function q(){$.dom.on("home","click",()=>window.history.back());$.dom.all("input",function(f){$.dom.on(f,"change",m);$.dom.on(f,"keydown",$.BGSS.enter2move)});$.dom.all("select",function(f){$.dom.on(f,"change",n)});$.dom.on("tablx","show.bs.tab",l)}var c={data:[],debug:!1,game:"",language:"en",names:[],players:0};return function(f){$.BGSS.storage2state($.BGSS.GAME_STORAGE,c);var e={debug:!1,language:"",names:"",players:0};$.param.setup(e);$.param.parse();
for(const g in e)(e=$.param.get(g))&&(c[g]="names"===g?e.split(","):e);c.game=f;$.BGSS[f].init&&$.BGSS[f].init(c);for(f=0;f<=c.players;f++)c.data[f]||(c.data[f]=d(f));b();$.BGSS.state2storage($.BGSS.GAME_STORAGE,c);c.debug&&console.log("state",c);q()}}();
$.BGSS["00269511"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=5*a.books,a.score+=a.ship1,a.score+=a.ship2,a.score-=a.anchors,a.score+=a.royal,a.score+=a.building,a.score+=Math.floor((a.coins+a.resources+a.cartographer+a.landscape)/5))}}}();
$.BGSS["00312484"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.research,a.score+=a.temple,a.score+=3*a.idol,a.score+=a.slot,a.score+=5*a.guardian,a.score+=a.artifact,a.score+=a.item,a.score-=a.fearc,a.score-=2*a.feart)}}}();
$.BGSS["00124361"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=Math.floor(a.money/10),a.score+=a.jupiter*a.houses,a.score+=a.saturnus*a.provinces,a.score+=a.mercurius*a.types,a.score+=a.mars*a.colonists,a.score+=3*a.brick,a.score+=3*a.food,a.score+=3*a.tool,a.score+=4*a.wine,a.score+=5*a.cloth,a.first&&(a.score+=7))}}}();
$.BGSS["00031260"]=function(){function a(c,f){c>=f.length&&(c=f.length-1);return f[c]}var b=[-1,-1,1,2,3,4],d=[-1,1,2,3,4],k=[-1,1,1,1,2,2,3,3,4],m=[-1,1,2,3,4],n=[-1,1,1,1,2,2,3,3,4],l=[-1,1,1,2,2,3,3,4],q=[-1,1,2,2,3,3,4];return{score:function(c,f){0!==f&&(c=c.data[f],c.score=0,c.score+=a(c.plowed,b),c.score+=a(c.pastures,d),c.score+=a(c.grain,k),c.score+=a(c.vegetables,m),c.score+=a(c.sheep,n),c.score+=a(c.boar,l),c.score+=a(c.cattle,q),c.score-=c.unused,c.score+=c.stables,c.score+=c.clay,c.score+=
2*c.stone,c.score+=3*c.family,c.score+=c.card,c.score+=c.bonus,c.score-=3*c.begging)}}}();
$.BGSS["00215471"]=function(){const a=[-3,1,3,4,7,8,10,11,11,11,11,11,11];return{init:function(b){let d;d=2===b.players?5:3===b.players?6:7;7>d&&$.dom.all(".color7",k=>$.dom.hide(k));6>d&&$.dom.all(".color6",k=>$.dom.hide(k));b.data[0]={colors:d}},score:function(b,d){if(0!==d){var k=b.data[0];b=b.data[d];b.score=0;for(d=1;d<=k.colors;d++)d!==b.missed&&(b["c"+d+"g"]&&(b.score+=5),b.score+=a[b["c"+d+"s"]],b.score-=2*b["c"+d+"b"])}}}}();
$.BGSS["00068448"]=function(){function a(b,d,k,m){if(0===m)return b*b+d*d+k*k+7*Math.min(b,d,k);m--;return Math.max(a(b+1,d,k,m),a(b,d+1,k,m),a(b,d,k+1,m))}return{score:function(b,d){0!==d&&(b=b.data[d],b.scientific=a(b.tablets,b.compasses,b.gears,b.wild),b.score=0,b.score+=Math.floor(b.coins/3),b.score+=b.military,b.score+=b.wonder,b.score+=b.civilian,b.score+=b.commercial,b.score+=b.guild,b.score+=b.scientific,b.score+=b.extra)}}}();
$.BGSS["00000050"]=function(){return{score:function(a,b){if(0!==b){a=a.data[b];a.score=0;for(let m=1;5>=m;m++){b=a.score;var d=a,k=m;let n=0;d["e"+k+"c1"]&&n++;d["e"+k+"c2"]&&n++;d["e"+k+"c3"]&&n++;let l=n,q=0;for(let c=2;10>=c;c++)d[$.sprintf("e%d%02d",k,c)]&&(l++,q+=c);l&&(q=(q-20)*(n+1),8<=l&&(q+=20));d["e"+k+"s"]=q;a.score=b+q}}}}}();
$.BGSS["00164928"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.coins,a.score+=a.grain,a.score+=2*a.cheese,a.score+=3*a.wine,a.score+=4*a.wool,a.score+=5*a.brocade,a.score+=(a.citizens+a.stations)*a.development,a.score+=a.extra)}}}();
$.BGSS["00193738"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=Math.floor(a.money/5),a.score+=a.buildings,a.score+=a.cities,a.score+=a.stations,a.score+=a.hazard,a.score+=a.cattle,a.score+=a.objective,a.score+=a.master,a.score+=4*a.workers,a.disc&&(a.score+=3),a.job&&(a.score+=2))}}}();
$.BGSS["00185343"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.buildings,a.score+=a.projects,a.score-=3*a.anomalies,a.score+=a.travel,a.score+=a.morale,a.score+=a.breakthroughs1,a.score+=a.breakthroughs2,a.score+=a.breakthroughs3,a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3),a.score+=a.tokens,a.score-=2*a.warps,a.endgame1&&(a.score+=3),a.endgame2&&(a.score+=3),a.endgame3&&(a.score+=3),a.endgame4&&(a.score+=3),a.endgame5&&(a.score+=3))}}}();
$.BGSS["00227224"]=function(){function a(b,d,k,m){for(var n=1;n<=b.players;n++)b.data[n]["t"+d+"p"]=0;n={};for(var l=1;l<=b.players;l++)n[m[l]]||(n[m[l]]=[]),n[m[l]].push(l);l=Object.keys(n).map(q=>parseInt(q,10));if(2!==b.players||1!==l.length){l.sort($.BGSS.numdec);m=2===b.players?3:2;for(const q of l){if(0===q)break;l=n[q];let c=0;for(const f of l)c+=k,k=Math.floor(k/m);c=Math.floor(c/l.length);if(0!==c)for(const f of l)b.data[f]["t"+d+"p"]=c}}}return{init:function(b){let d;d=2===b.players?4:3===
b.players?5:6;6>d&&$.dom.all(".tower6",k=>$.dom.hide(k));5>d&&$.dom.all(".tower5",k=>$.dom.hide(k));b.data[0]={towers:d}},score:function(b,d){let k=b.data[0];if(0===d)for(d=1;d<=k.towers;d++){let m=0,n=[];for(let l=1;l<=b.players;l++){let q=b.data[l];m+=2*q["t"+d+"s"];m+=q["t"+d+"o"];n[l]=0;n[l]+=q["t"+d+"s"];n[l]+=q["t"+d+"o"]}a(b,d,m,n)}else for(b=b.data[d],b.score=0,b.score+=b.prestige,b.score+=Math.floor(b.leftover/5),d=1;d<=k.towers;d++)b.score+=b["t"+d+"p"]}}}();
$.BGSS["00258389"]=function(){return{score:function(a,b){if(0!==b){var d=a.data[0];a=a.data[b];a.score=0;a.score+=5*a.people;a.score+=a.quarters;a.score+=Math.floor((a.energy+a.food+a.money)/10);d.variant1?(a.score-=a.loans,a.score+=a.actions):(a.score-=3*a.loans,a.score+=3*a.actions);d.variant2?(a.score+=2*a.xenergy,a.score+=2*a.xfood):(a.score+=a.xenergy,a.score+=a.xfood)}}}}();
$.BGSS["00228959"]=function(){return{init:function(a){$.dom.hidden("nosolo1",1===a.players)},score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.estates,a.score+=a.stations,a.score+=a.tracks,a.score+=a.contracts,a.score+=a.equipment,a.score+=a.chai,a.score+=a.tea/2)}}}();
$.BGSS["00216132"]=function(){function a(b,d,k){let m={};for(var n=1;n<=b.players;n++)m[b.data[n][d]]||(m[b.data[n][d]]=[]),m[b.data[n][d]].push(n);var l=Object.keys(m).map(q=>parseInt(q,10));l.sort($.BGSS.numdec);n=0;for(const q of l){l=m[q];let c=0;for(const f of l)c+=k[n++];c=Math.floor(c/l.length);for(const f of l)b.data[f][d+"_vp"]=c}}return{score:function(b,d){let k=b.data[0];if(0===d){let m={cotton:.1,tobacco:.2,sugar:.3};for(d=1;d<=b.players;d++)m.cotton+=b.data[d].cotton,m.tobacco+=b.data[d].tobacco,
m.sugar+=b.data[d].sugar;d=["cotton","tobacco","sugar"];d.sort(function(n,l){return m[n]>m[l]?1:m[n]<m[l]?-1:0});k[d[0]]=5;k[d[1]]=4;k[d[2]]=3;3<=b.players?(a(b,"contracts",[12,6,0,0]),a(b,"settlements",[18,12,6,0])):(a(b,"contracts",[8,0]),a(b,"settlements",[12,0]))}else b=b.data[d],b.score=0,b.score+=b.glory,b.score+=b.basic,b.score+=2*b.processed,b.score+=Math.floor(b.money/10),b.score+=b.money%10/10,b.score+=b.hops,b.score+=b.cotton*k.cotton,b.score+=b.tobacco*k.tobacco,b.score+=b.sugar*k.sugar,
b.score+=b.contracts_vp,b.score+=b.settlements_vp}}}();$.BGSS["00169786"]=function(){return{score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.coins,6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):12>=a.popularity?(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*Math.floor(a.resources/2)):(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2)),a.score+=a.bonus,a.score-=a.malus)}}}();
