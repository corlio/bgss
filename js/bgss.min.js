var bgss=(function(){var f=[];var u=false;var e={"185343":{en:"Anachrony",fr:"Anachrony",min:1,max:4},"216132":{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4},"124361":{en:"Concordia",fr:"Concordia",min:2,max:5},"193738":{en:"Great Western Trail",fr:"Great Western",min:2,max:4},"164928":{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5}};var o={};var l={};function i(F,G){var E={};for(var I=1;I<=o.players;I++){if(!E[f[I][F]]){E[f[I][F]]=[]}E[f[I][F]].push(I)}var D=Object.keys(E);D.sort(function(K,J){if(parseInt(K)>parseInt(J)){return(-1)}if(parseInt(K)<parseInt(J)){return(+1)}return(0)});var H=0;$.each(D,function(J,L){var K=E[L];var N=0;var M;for(M=0;M<K.length;M++){N+=G[H++]}N=Math.floor(N/K.length);for(M=0;M<K.length;M++){f[K[M]][F+"_bonus"]=N}})}function h(D,E){E=E||0;for(var F=1;F<=o.players;F++){E+=f[F][D]}if(D in l&&l[D]==E){return(0)}l[D]=E;return(1)}function g(E){if(E.attr("type")=="checkbox"){return(E.prop("checked"))}var F=E.val();if(!F){return(0)}var D=parseInt(F);if(D.toString()!=F){E.val(D)}return(D)}function b(E){var D=[];$.each(e,function(G,F){if(!F[E]){return}D.push([G,F[E]])});D.sort(function(G,F){if(G[1]>F[1]){return(+1)}if(G[1]<F[1]){return(-1)}return(0)});$("#game").data(E,D)}function z(E,G){var F=E.clone().attr("id","player"+G);var D;F.find("*").each(function(H){D=$(this).attr("id");if(D){$(this).attr("id",D+"-"+G)}D=$(this).attr("for");if(D){$(this).attr("for",D+"-"+G)}D=$(this).attr("data-index");if(D){$(this).attr("data-index",G+D)}});return(F)}function p(G){var H;for(H=0;H<=o.players;H++){f.push({})}var E=$("#tabs").children("li").last();for(H=o.players;H>=1;H--){var D=$("<a>").attr("href","#player"+H).text(H);var F=$("<li>").addClass("tabs-title").append(D);E.before(F);E=F}E=$("#_player_");for(H=1;H<=o.players;H++){$("#tabs-content").append(z(E,H))}E.remove();$("#tabs").on("change.zf.tabs",function(){var K=$("#tabs-content").find(".tabs-panel.is-active").attr("id");var I=e[o.game][o.language];if(K&&K.startsWith("player")){var J=parseInt(K.substr(6));$("#title").html(I+" - "+o.player[J-1])}else{$("#title").html(I)}});$("#tabs-content").find("input,select").each(function(J){var L=$(this).attr("id");if(L){var I=L.substr(0,L.length-2);var K=parseInt(L.substr(-1));f[K][I]=g($(this));if(I=="score"){return}$(this).change(function(){f[K][I]=g($(this));G(K)})}});Foundation.reInit($("#tabs"))}function C(){var D=$("#results table tbody");for(var F=1;F<=o.players;F++){var E=$("<tr>");E.append($("<td>").html(o.player[F-1]));E.append($("<td>").attr("id","result-"+F).text("0"));D.append(E)}}function m(){$("form").on("keydown","input",function(G){if(G.which==13){G.preventDefault();var D=$(G.target);var E=D.attr("data-index");if(E){var F=parseInt(E)+1;$("[data-index="+F+"]").focus()}}})}function n(){var D="[lang="+o.language+"]";$("body").find("[lang]").not(D).hide();$("body").find(D).show();$("#container").find("select.langaware").each(function(G){var E=$(this);var H=E.val();var F=E.data(o.language);E.empty();$.each(F,function(J,I){E.append($("<option>").attr("value",I[0]).html(I[1]))});if(H){E.val(H)}})}function d(){var D=e[o.game];$("#players").children("option").each(function(E){var F=$(this).attr("value");if(D.min<=F&&F<=D.max){$(this).show()}else{$(this).hide()}})}function c(){$("#container").children("div").each(function(D){var F=$(this).attr("id");if(F&&F.startsWith("player")){var E=parseInt(F.substr(6));if(E<=o.players){$(this).show()}else{$(this).hide()}}})}function r(D){}function y(){$("#tabs").children("li").first().click()}function q(){$("#language").val(o.language);n();$("#game").val(o.game);d();$("#players").val(o.players);c();$.each(o.player,function(E,D){var F=E+1;$("input#player"+F).val(D);r(F)})}function v(){if(typeof(Storage)!=="undefined"){if(u){console.log("store",o)}localStorage.setItem("bgss",JSON.stringify(o))}}function j(){if(typeof(Storage)!=="undefined"){var D=localStorage.getItem("bgss");if(D){o=JSON.parse(D);if(u){console.log("fetch",o)}return}}o={language:"en",game:"164928",players:4,player:["","","","","","",""]}}function t(){o={language:"en",players:4,player:["1","2","3","4","5","6","7"]};var F=window.location.hash;if(F.length){$.each(F.substr(1).split("&"),function(G,I){var H=I.split("=");if(H.length===2&&(H[0]=="language"||H[0]=="players")){o[H[0]]=H[1]}else{if(H.length===2&&H[0]=="names"){o.player=H[1].split(",").map(decodeURI)}else{throw ("unexpected query: "+I)}}})}var E=window.location.pathname.match(/(\d+)\.html$/);if(E){var D=e[E[1]];if(D){o.game=E[1];$("#title").html(D[o.language]);document.title="BGSS - "+$("#title").text()}else{throw ("unexpected game: "+E[1])}}else{throw ("unexpected pathname: "+window.location.pathname)}if(u){console.log("search",o)}}function B(D,G){var E=f[G];if(!E[D]){return}for(var F=1;F<=o.players;F++){if(F!=G&&f[F][D]){$("#"+D+"-"+F).click()}}}function x(E){var D=f[E];D.score=0;D.score+=D.buildings;D.score+=D.projects;D.score+=D.anomalies*-3;D.score+=D.travel;D.score+=D.morale;D.score+=D.breakthroughs1;D.score+=D.breakthroughs2;D.score+=D.breakthroughs3;D.score+=Math.min(D.breakthroughs1,D.breakthroughs2,D.breakthroughs3)*2;D.score+=D.tokens;D.score+=D.warps*-2;if(D.endgame1){D.score+=3}if(D.endgame2){D.score+=3}if(D.endgame3){D.score+=3}if(D.endgame4){D.score+=3}if(D.endgame5){D.score+=3}if(u){console.log("player "+E+" score:",D.score,D)}$("#score-"+E).val(D.score);$("#result-"+E).text(D.score)}function w(G){var F=0;F+=h("cotton",0.1);F+=h("tobacco",0.2);F+=h("sugar",0.3);if(F){var E=["cotton","tobacco","sugar"];E.sort(function(I,H){if(l[I]>l[H]){return(+1)}if(l[I]<l[H]){return(-1)}return(0)});f[0][E[0]]=5;f[0][E[1]]=4;f[0][E[2]]=3;$("#vp_cotton").text(f[0].cotton);$("#vp_tobacco").text(f[0].tobacco);$("#vp_sugar").text(f[0].sugar)}F+=h("contracts");F+=h("settlements");if(o.players>=3){i("contracts",[12,6,0,0]);i("settlements",[18,12,6,0])}else{i("contracts",[8,0]);i("contracts",[12,0])}if(F||!G){if(u){console.log("general",f[0])}for(var D=1;D<=o.players;D++){k(D)}}else{k(G)}}function k(E){var D=f[E];D.score=0;D.score+=D.glory;D.score+=D.basic;D.score+=D.processed*2;D.score+=Math.floor(D.money/10);D.score+=(D.money%10)/10;D.score+=D.hops;D.score+=D.cotton*f[0].cotton;D.score+=D.tobacco*f[0].tobacco;D.score+=D.sugar*f[0].sugar;D.score+=D.contracts_bonus;D.score+=D.settlements_bonus;if(u){console.log("player "+E+" score:",D.score,D)}$("#score-"+E).val(D.score);$("#result-"+E).text(D.score)}function s(E){var D=f[E];B("first",E);D.score=0;D.score+=Math.floor(D.money/10);D.score+=D.jupiter*D.houses;D.score+=D.saturnus*D.provinces;D.score+=D.mercurius*D.types;D.score+=D.mars*D.colonists;D.score+=D.brick*3;D.score+=D.food*3;D.score+=D.tool*3;D.score+=D.wine*4;D.score+=D.cloth*5;if(D.first){D.score+=7}if(u){console.log("player "+E+" score:",D.score,D)}$("#score-"+E).val(D.score);$("#result-"+E).text(D.score)}function A(E){var D=f[E];B("job",E);D.score=0;D.score+=Math.floor(D.money/5);D.score+=D.buildings;D.score+=D.cities;D.score+=D.stations;D.score+=D.hazard;D.score+=D.cattle;D.score+=D.objective;D.score+=D.master;D.score+=D.workers*4;if(D.disc){D.score+=3}if(D.job){D.score+=2}if(u){console.log("player "+E+" score:",D.score,D)}$("#score-"+E).val(D.score);$("#result-"+E).text(D.score)}function a(E){var D=f[E];D.score=0;D.score+=D.coins;D.score+=D.grain;D.score+=D.cheese*2;D.score+=D.wine*3;D.score+=D.wool*4;D.score+=D.brocade*5;D.score+=(D.citizens+D.stations)*D.development;if(u){console.log("player "+E+" score:",D.score,D)}$("#score-"+E).val(D.score);$("#result-"+E).text(D.score)}return({init_main:function(){b("en");b("fr");m();$("#language").change(function(){o.language=$(this).val();if(u){console.log("language changed:",o.language)}n();v()});$("#game").change(function(){o.game=$(this).val();if(u){console.log("game changed:",o.game)}d();v()});$("#players").change(function(){o.players=$(this).val();if(u){console.log("players changed:",o.players)}c();v()});$("#container").find("input").each(function(D){var F=$(this).attr("id");if(F&&F.startsWith("player")){var E=parseInt(F.substr(6));$(this).change(function(){o.player[E-1]=$(this).val().trim();if(u){console.log("player "+E+" changed:",o.player[E-1])}r(E);v()})}});$("#clear").click(function(){for(var D=1;D<=7;D++){o.player[D-1]="";$("input#player"+D).val("");r(D)}v()});$("#next").click(function(){var E=[];for(var F=1;F<=o.players;F++){E.push(o.player[F-1]||F)}var D=o.game+".html#language="+o.language+"&players="+o.players+"&names="+E.map(encodeURI).join(",");window.location.href=D});j();q()},init_124361:function(){t();C();p(s);m();n();y()},init_164928:function(){t();C();p(a);m();n();y()},init_185343:function(){t();C();p(x);m();n();y()},init_193738:function(){t();C();p(A);m();n();y()},init_216132:function(){t();C();p(w);m();n();y();w(0)}})})();