var bgss=function(){function f(a){h.score(g[0],g[a]);var c=g[a].score;e.debug&&console.log("player "+a+" score:",c,g[a]);$("#score-"+a).val(c);$("#result-"+a).text(c)}function a(a){var c=0;h.common&&(c+=h.common(g[0]));if(c)for(e.debug&&console.log("general:",g[0]),a=1;a<=e.players;a++)f(a);else f(a)}function b(a){if("checkbox"==a.attr("type"))return a.prop("checked");var c=a.val();if(!c)return 0;var b=parseInt(c);b.toString()!=c&&a.val(b);return b}function d(a){var c=[];$.each(n,function(b,e){e[a]&&
c.push([b,e[a]])});c.sort(function(a,c){return a[1]>c[1]?1:a[1]<c[1]?-1:0});$("#game").data(a,c)}function k(a,b){var c=a.clone().attr("id","player"+b),e;c.find("*").each(function(a){(e=$(this).attr("id"))&&$(this).attr("id",e+"-"+b);(e=$(this).attr("for"))&&$(this).attr("for",e+"-"+b);(e=$(this).attr("data-index"))&&$(this).attr("data-index",b+e)});return c}function x(){var c;for(c=0;c<=e.players;c++)g.push({});g[0].sum={};var d=$("#tabs").children("li").last();for(c=e.players;1<=c;c--){var q=$("<a>").attr("href",
"#player"+c).text(c),q=$("<li>").addClass("tabs-title").append(q);d.before(q);d=q}d=$("#_player_");for(c=1;c<=e.players;c++)$("#tabs-content").append(k(d,c));d.remove();$("#tabs").on("change.zf.tabs",function(){var a=$("#tabs-content").find(".tabs-panel.is-active").attr("id"),c=n[e.game][e.language];a&&a.startsWith("player")?(a=parseInt(a.substr(6)),$("#title").html(c+" - "+e.player[a-1])):$("#title").html(c)});$("#tabs-content").find("input,select").each(function(c){if(c=$(this).attr("id")){var d=
c.substr(0,c.length-2),m=parseInt(c.substr(-1));g[m][d]=b($(this));"score"!=d&&$(this).change(function(){g[m][d]=b($(this));if($(this).hasClass("highlander")&&g[m][d])for(var c=1;c<=e.players;c++)c!=m&&g[c][d]&&$("#"+d+"-"+c).click();a(m)})}});for(c=1;c<=e.players;c++)a(c);Foundation.reInit($("#tabs"))}function u(){$("form").on("keydown","input",function(a){13==a.which&&(a.preventDefault(),a=$(a.target).attr("data-index"))&&(a=parseInt(a)+1,$("[data-index="+a+"]").focus())})}function y(){$("#language").change(function(){e.language=
$(this).val();e.debug&&console.log("language changed:",e.language);t();p()});$("#game").change(function(){e.game=$(this).val();e.debug&&console.log("game changed:",e.game);v();p()});$("#players").change(function(){e.players=$(this).val();e.debug&&console.log("players changed:",e.players);w();p()});$("#container").find("input").each(function(a){if((a=$(this).attr("id"))&&a.startsWith("player")){var c=parseInt(a.substr(6));$(this).change(function(){e.player[c-1]=$(this).val().trim();e.debug&&console.log("player "+
c+" changed:",e.player[c-1]);p()})}});$("#clear").click(function(){for(var a=1;7>=a;a++)e.player[a-1]="",$("input#player"+a).val("");p()});$("#next").click(function(){var a=window.location,b=e.game+".html#language="+e.language+"&players="+e.players;e.debug&&(b+="&debug=1");for(var d=[],r=1;r<=e.players;r++)d.push(e.player[r-1]||r);b+="&names="+d.map(encodeURI).join(",");a.href=b})}function t(){var a="[lang="+e.language+"]";$("body").find("[lang]").not(a).hide();$("body").find(a).show();$("#container").find("select.langaware").each(function(a){var c=
$(this);a=c.val();var b=c.data(e.language);c.empty();$.each(b,function(a,b){c.append($("<option>").attr("value",b[0]).html(b[1]))});a&&c.val(a)})}function v(){var a=n[e.game];$("#players").children("option").each(function(c){c=$(this).attr("value");a.min<=c&&c<=a.max?$(this).show():$(this).hide()})}function w(){$("#container").children("div").each(function(a){(a=$(this).attr("id"))&&a.startsWith("player")&&(parseInt(a.substr(6))<=e.players?$(this).show():$(this).hide())})}function z(){$("#language").val(e.language);
t();$("#game").val(e.game);v();$("#players").val(e.players);w();$.each(e.player,function(a,b){$("input#player"+(a+1)).val(b)})}function p(){"undefined"!==typeof Storage&&(e.debug&&console.log("store",e),localStorage.setItem("bgss",JSON.stringify(e)))}function A(){e={language:"en",players:4,player:"1234567".split("")};var a=window.location.hash;a.length&&$.each(a.substr(1).split("&"),function(a,b){var c=b.split("=");if(2!==c.length||"debug"!=c[0]&&"language"!=c[0]&&"players"!=c[0])if(2===c.length&&
"names"==c[0])e.player=c[1].split(",").map(decodeURI);else throw"unexpected query: "+b;else e[c[0]]=c[1]});if(a=window.location.pathname.match(/(\d+)\.html$/))if(h=n[a[1]])e.game=a[1],$("#title").html(h[e.language]),document.title="BGSS - "+$("#title").text();else throw"unexpected game: "+a[1];else throw"unexpected pathname: "+window.location.pathname;e.debug&&console.log("search",e)}var g=[],n={},e={},h;return{define:function(a,b){n[a]=b},init_main:function(){var a=window.location.hash;a.length&&
(a=a.match(/debug=(\d)/))&&(e.debug=parseInt(a[1]));d("en");d("fr");u();y();a:{a=e.debug;if("undefined"!==typeof Storage){var b=localStorage.getItem("bgss");if(b){e=JSON.parse(b);"undefined"!==typeof a&&(e.debug=a);e.debug&&console.log("fetch",e);break a}}e={language:"en",game:"164928",players:4,player:"      ".split(" ")};"undefined"!==typeof a&&(e.debug=a)}z()},init_game:function(){A();h.init&&h.init(e);for(var a=$("#results table tbody"),b=1;b<=e.players;b++){var d=$("<tr>");d.append($("<td>").html(e.player[b-
1]));d.append($("<td>").attr("id","result-"+b).text("0"));a.append(d)}x();u();t();$("#tabs").children("li").first().click()},update_sum:function(a,b){b=b||0;for(var c=1;c<=e.players;c++)b+=g[c][a];if(a in g[0].sum&&g[0].sum[a]==b)return 0;g[0].sum[a]=b;return 1},update_majority:function(a,b){for(var c={},d=1;d<=e.players;d++)c[g[d][a]]||(c[g[d][a]]=[]),c[g[d][a]].push(d);d=Object.keys(c);d.sort(function(a,b){return parseInt(a)>parseInt(b)?-1:parseInt(a)<parseInt(b)?1:0});var f=0;$.each(d,function(d,
e){var h=c[e],k=0,l;for(l=0;l<h.length;l++)k+=b[f++];k=Math.floor(k/h.length);for(l=0;l<h.length;l++)g[h[l]][a+"_bonus"]=k})}}}();bgss.define("124361",function(){return{en:"Concordia",fr:"Concordia",min:2,max:5,score:function(f,a){a.score=0;a.score+=Math.floor(a.money/10);a.score+=a.jupiter*a.houses;a.score+=a.saturnus*a.provinces;a.score+=a.mercurius*a.types;a.score+=a.mars*a.colonists;a.score+=3*a.brick;a.score+=3*a.food;a.score+=3*a.tool;a.score+=4*a.wine;a.score+=5*a.cloth;a.first&&(a.score+=7)}}}());bgss.define("164928",function(){return{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5,score:function(f,a){a.score=0;a.score+=a.coins;a.score+=a.grain;a.score+=2*a.cheese;a.score+=3*a.wine;a.score+=4*a.wool;a.score+=5*a.brocade;a.score+=(a.citizens+a.stations)*a.development}}}());bgss.define("193738",function(){return{en:"Great Western Trail",fr:"Great Western",min:2,max:4,score:function(f,a){a.score=0;a.score+=Math.floor(a.money/5);a.score+=a.buildings;a.score+=a.cities;a.score+=a.stations;a.score+=a.hazard;a.score+=a.cattle;a.score+=a.objective;a.score+=a.master;a.score+=4*a.workers;a.disc&&(a.score+=3);a.job&&(a.score+=2)}}}());bgss.define("185343",function(){return{en:"Anachrony",fr:"Anachrony",min:1,max:4,score:function(f,a){a.score=0;a.score+=a.buildings;a.score+=a.projects;a.score-=3*a.anomalies;a.score+=a.travel;a.score+=a.morale;a.score+=a.breakthroughs1;a.score+=a.breakthroughs2;a.score+=a.breakthroughs3;a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3);a.score+=a.tokens;a.score-=2*a.warps;a.endgame1&&(a.score+=3);a.endgame2&&(a.score+=3);a.endgame3&&(a.score+=3);a.endgame4&&(a.score+=3);a.endgame5&&
(a.score+=3)}}}());bgss.define("216132",function(){var f,a;return{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4,init:function(b){3<=b.players?(f=[12,6,0,0],a=[18,12,6,0]):(f=[8,0],a=[12,0])},common:function(b){var d;d=0+bgss.update_sum("cotton",.1);d+=bgss.update_sum("tobacco",.2);if(d+=bgss.update_sum("sugar",.3)){var k=["cotton","tobacco","sugar"];k.sort(function(a,d){return b.sum[a]>b.sum[d]?1:b.sum[a]<b.sum[d]?-1:0});b[k[0]]=5;b[k[1]]=4;b[k[2]]=3;$("#vp_cotton").text(b.cotton);$("#vp_tobacco").text(b.tobacco);
$("#vp_sugar").text(b.sugar)}d+=bgss.update_sum("contracts");d+=bgss.update_sum("settlements");bgss.update_majority("contracts",f);bgss.update_majority("settlements",a);return d},score:function(a,d){d.score=0;d.score+=d.glory;d.score+=d.basic;d.score+=2*d.processed;d.score+=Math.floor(d.money/10);d.score+=d.money%10/10;d.score+=d.hops;d.score+=d.cotton*a.cotton;d.score+=d.tobacco*a.tobacco;d.score+=d.sugar*a.sugar;d.score+=d.contracts_bonus;d.score+=d.settlements_bonus}}}());bgss.define("31260",function(){function f(a,b){a>=b.length&&(a=b.length-1);return b[a]}return{en:"Agricola",fr:"Agricola",min:1,max:5,score:function(a,b){b.score=0;b.score+=f(b.plowed,[-1,-1,1,2,3,4]);b.score+=f(b.pastures,[-1,1,2,3,4]);b.score+=f(b.grain,[-1,1,1,1,2,2,3,3,4]);b.score+=f(b.vegetables,[-1,1,2,3,4]);b.score+=f(b.sheep,[-1,1,1,1,2,2,3,3,4]);b.score+=f(b.boar,[-1,1,1,2,2,3,3,4]);b.score+=f(b.cattle,[-1,1,2,2,3,3,4]);b.score-=b.unused;b.score+=b.stables;b.score+=b.clay;b.score+=2*b.stone;
b.score+=3*b.family;b.score+=b.card;b.score+=b.bonus;b.score-=3*b.begging}}}());
