var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.checkStringArgs=function(b,a,c){if(null==b)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(a instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return b+""};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,c){b!=Array.prototype&&b!=Object.prototype&&(b[a]=c.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(b,a,c,d){if(a){c=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var g=b[d];g in c||(c[g]={});c=c[g]}b=b[b.length-1];d=c[b];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(c,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var g=b.length,l=a.length;c=Math.max(0,Math.min(c|0,b.length));for(var p=0;p<l&&c<g;)if(b[c++]!=a[p++])return!1;return p>=l}},"es6","es3");$jscomp.findInternal=function(b,a,c){b instanceof String&&(b=String(b));for(var d=b.length,g=0;g<d;g++){var l=b[g];if(a.call(c,l,g,b))return{i:g,v:l}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(b){var a=0;return function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var b=0;return function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+b++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,a){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var c=0,d={next:function(){if(c<b.length){var g=c++;return{value:a(g,b[g]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
var bgss=function(){function b(){var a=new Date;return a.getFullYear()+"/"+("0"+(a.getMonth()+1)).substr(-2)+"/"+("0"+a.getDate()).substr(-2)+"-"+("0"+a.getHours()).substr(-2)+":"+("0"+a.getMinutes()).substr(-2)+":"+("0"+a.getSeconds()).substr(-2)}function a(a){n.score(h[0],h[a]);var c=h[a].score;e.debug&&console.log("player "+a+" score:",c,h[a]);$("#score-"+a).is("input")?$("#score-"+a).val(c):$("#score-"+a).text(c);$("#result-"+a).text(c)}function c(c){var k=0;n.common&&(k+=n.common(h[0]));if(k||
0===c)for(e.debug&&console.log("general:",h[0]),c=1;c<=e.players;c++)a(c);else a(c);k={};var d=0;for(c=1;c<=e.players;c++)h[c].score in k?d++:k[h[c].score]=1;d?$("#tie").show():$("#tie").hide();$("#date").text(b())}function d(a){var c=0;if("checkbox"==a.attr("type"))return a.prop("checked");if(a.hasClass("togglable"))return!a.hasClass("hollow");var b=a.val();if(!b)return 0;var d=b.startsWith(".")?-parseInt(b.substr(1)):parseInt(b);d.toString()!=b&&c++;b=a.attr("min");"undefined"!==typeof b&&d<b&&
(d=b,c++);b=a.attr("max");"undefined"!==typeof b&&d>b&&(d=b,c++);c&&a.val(d);return d}function g(a){var c=[];$.each(q,function(b,d){d[a]&&c.push([b,d[a]])});c.sort(function(a,c){return a[1]>c[1]?1:a[1]<c[1]?-1:0});$("#game").data(a,c)}function l(a,c){a=a.clone().attr("id","player"+c);var b;a.find("*").each(function(a){(b=$(this).attr("id"))&&$(this).attr("id",b+"-"+c);(b=$(this).attr("for"))&&$(this).attr("for",b+"-"+c)});var d=1;a.find("input").each(function(a){$(this).attr("data-index",c+("0"+d).substr(-2));
a=$(this).attr("min");var b=$(this).attr("max");"undefined"!==typeof a&&"undefined"!==typeof b&&$(this).attr("placeholder",a+"-"+b);"undefined"===typeof a||"0"===a||$(this).attr("value")||$(this).attr("value",a);d++});return a}function p(){$("select[data-init]").each(function(a){a=$(this).data("init").split("/").map(function(a){return parseInt(a)});for(var c=a[0];c<=a[2];c++){var b=$("<option>").attr("value",c).text(c);c==a[1]&&b.attr("selected","selected");$(this).append(b)}})}function t(){var a;
for(a=0;a<=e.players;a++)h.push({id:a});h[0].sum={};var b=$("#tabs").children("li").last();for(a=e.players;1<=a;a--){var f=$("<a>").attr("href","#player"+a).text(a);f=$("<li>").addClass("tabs-title").append(f);b.before(f);b=f}b=$("#_player_");for(a=1;a<=e.players;a++)$("#tabs-content").append(l(b,a));b.remove();$("#tabs").on("change.zf.tabs",function(){var a=$("#tabs-content").find(".tabs-panel.is-active").attr("id"),c=q[e.game][e.language];if(a&&a.startsWith("player")){a=parseInt(a.substr(6));var b=
'<span id="score-'+a+'">'+h[a].score+"</span>";$("#title").html(c+" - "+e.player[a-1]+" = "+b)}else $("#title").html(c)});$("#tabs-content").find("input,select").each(function(a){var b=$(this).attr("id");if(b&&(a=$(this).closest("div.tabs-panel").attr("id"))){if(a.startsWith("player")){var k=parseInt(a.substr(-1));var f=b.substr(0,b.length-2)}else k=0,f=b;b in m&&("checkbox"==$(this).attr("type")?m[b]?$(this).prop("checked",!0):$(this).prop("checked",!1):$(this).val(m[b]));h[k][f]=d($(this));$(this).change(function(){h[k][f]=
d($(this));if($(this).hasClass("highlander")){var a=f,x=k;if(h[x][a])for(var g=1;g<=e.players;g++)g!=x&&h[g][a]&&$("#"+a+"-"+g).click()}m[b]=h[k][f];y();c(k)})}});$("#tabs-content").find("a.togglable").each(function(a){var b=$(this).attr("id");if(b&&(a=$(this).closest("div.tabs-panel").attr("id"))){if(a.startsWith("player")){var k=parseInt(a.substr(-1));var e=b.substr(0,b.length-2)}else k=0,e=b;b in m&&(m[b]?$(this).removeClass("hollow"):$(this).addClass("hollow"));h[k][e]=d($(this));$(this).click(function(){$(this).hasClass("hollow")?
($(this).removeClass("hollow"),h[k][e]=!0):($(this).addClass("hollow"),h[k][e]=!1);m[b]=h[k][e];y();c(k)})}});for(a=1;a<=e.players;a++)c(a);Foundation.reInit($("#tabs"));$(".accordion").foundation()}function u(){$("body").on("keydown","input",function(a){13==a.which&&(a.preventDefault(),a=$(a.target).attr("data-index"))&&(a=parseInt(a)+1,$("[data-index="+a+"]").focus())})}function f(){$("#language").change(function(){e.language=$(this).val();e.debug&&console.log("language changed:",e.language);v();
r()});$("#game").change(function(){e.game=$(this).val();e.debug&&console.log("game changed:",e.game);z();r()});$("#players").change(function(){e.players=$(this).val();e.debug&&console.log("players changed:",e.players);w();r()});$("body").find("input").each(function(a){if((a=$(this).attr("id"))&&a.startsWith("player")){var c=parseInt(a.substr(6));$(this).change(function(){e.player[c-1]=$(this).val().trim();e.player[c-1]!=$(this).val()&&$(this).val(e.player[c-1]);e.debug&&console.log("player "+c+" changed:",
e.player[c-1]);r()})}});$("#clear").click(function(){for(var a=1;7>=a;a++)e.player[a-1]="",$("#player"+a).val("");r()});$("#next").click(function(){var a=window.location,c=e.game+".html#reset=1&language="+e.language+"&players="+e.players;e.debug&&(c+="&debug=1");for(var b=[],d=1;d<=e.players;d++)b.push(e.player[d-1]||d);c+="&names="+b.map(encodeURI).join(",");a.href=c})}function v(){var a="[lang="+e.language+"]";$("body").find("[lang]").not(a).hide();$("body").find(a).show();$("body").find("select.langaware").each(function(a){var c=
$(this);a=c.val();var b=c.data(e.language);c.empty();$.each(b,function(a,b){c.append($("<option>").attr("value",b[0]).html(b[1]))});a&&c.val(a)})}function z(){var a=q[e.game];$("#players").children("option").each(function(c){c=$(this).attr("value");a.min<=c&&c<=a.max?$(this).show():$(this).hide()});var c=0;e.players<a.min?c=a.min:e.players>a.max&&(c=a.max);c&&(e.players=c,$("#players").val(e.players),w());a.min==a.max?$("#players").prop("disabled","disabled"):$("#players").prop("disabled",!1)}function w(){$("body").find("div").each(function(a){(a=
$(this).attr("id"))&&a.startsWith("div")&&(parseInt(a.substr(3))<=e.players?$(this).show():$(this).hide())})}function A(){$("#language").val(e.language);v();$("#game").val(e.game);z();$("#players").val(e.players);w();$.each(e.player,function(a,c){$("#player"+(a+1)).val(c)})}function y(){"undefined"!==typeof Storage&&(e.debug&&console.log("store",m),localStorage.setItem("bgss.game",JSON.stringify(m)))}function r(){if("undefined"!==typeof Storage){e.debug&&console.log("store",e);var a={};$.each(e.player,
function(c,b){a[b]=1});e.names&&$.each(e.names,function(c,b){a[b]=1});delete a[""];e.names=Object.keys(a);e.names.sort();localStorage.setItem("bgss.main",JSON.stringify(e))}}function B(){var a=e.debug;if("undefined"!==typeof Storage){var c=localStorage.getItem("bgss.main");if(c){e=JSON.parse(c);"undefined"!==typeof a&&(e.debug=a);e.debug&&console.log("fetch",e);e.names&&$.each(e.names,function(a,c){$("datalist#names").append($("<option>").text(c))});return}}e={language:"en",game:"164928",players:4,
player:"      ".split(" ")};"undefined"!==typeof a&&(e.debug=a)}function C(){e={language:"en",players:4,player:"1234567".split("")};var a=window.location.hash;a.length&&$.each(a.substr(1).split("&"),function(a,c){a=c.split("=");if(2===a.length&&"language"==a[0])e[a[0]]=a[1];else if(2!==a.length||"debug"!=a[0]&&"players"!=a[0]&&"reset"!=a[0])if(2===a.length&&"names"==a[0])e.player=a[1].split(",").map(decodeURI);else throw"unexpected query: "+c;else e[a[0]]=parseInt(a[1])});window.location.hash=a.replace("reset=1&",
"");if(a=window.location.pathname.match(/(\d+)\.html$/))if(n=q[a[1]])e.game=a[1],$("#title").html(n[e.language]),document.title="BGSS - "+$("#title").text();else throw"unexpected game: "+a[1];else throw"unexpected pathname: "+window.location.pathname;e.debug&&console.log("url2state",e)}var m={},h=[],q={},e={},n;return{define:function(a,c){q[a]=c},init_main:function(){var a=window.location.hash;a.length&&(a=a.match(/debug=(\d)/))&&(e.debug=parseInt(a[1]));g("en");g("fr");u();f();B();A()},init_game:function(){C();
if("undefined"!==typeof Storage)if(e.reset)localStorage.removeItem("bgss.game");else{var a=localStorage.getItem("bgss.game");a&&(m=JSON.parse(a),e.debug&&console.log("fetch",m))}n.init&&n.init(e);a=$("#results table tbody");for(var c=1;c<=e.players;c++){var b=$("<tr>");b.append($("<td>").html(e.player[c-1]));b.append($("<td>").attr("id","result-"+c).text("0"));a.append(b)}p();t();u();n.setup&&n.setup(e);v();$("#tabs").children("li").first().click()},update_majority:function(a,c){for(var b={},d=1;d<=
e.players;d++)b[h[d][a]]||(b[h[d][a]]=[]),b[h[d][a]].push(d);d=Object.keys(b);d.sort(function(a,c){return parseInt(a)>parseInt(c)?-1:parseInt(a)<parseInt(c)?1:0});var f=0,g;$.each(d,function(d,e){d=b[e];for(g=e=0;g<d.length;g++)e+=c[f++];e=Math.floor(e/d.length);for(g=0;g<d.length;g++)h[d[g]][a+"_bonus"]=e})},update_sum:function(a,c){c=c||0;for(var b=1;b<=e.players;b++)c+=h[b][a];if(a in h[0].sum&&h[0].sum[a]==c)return 0;h[0].sum[a]=c;return 1}}}();bgss.define("00215471",function(){var b=7,a=[-3,1,3,4,7,8,10,11];return{en:"Wind the Film!",fr:"Wind the Film!",min:2,max:4,init:function(a){b=2==a.players?5:3==a.players?6:7},setup:function(a){7>b&&$(".color7").hide();6>b&&$(".color6").hide()},score:function(c,d){d.score=0;for(c=1;c<=b;c++)if(c==d.regret)$("#player1 .color"+c).hide();else{$("#player1 .color"+c).show();d["c"+c+"-g"]&&(d.score+=5);var g=d.score,l=d["c"+c+"-s"];l>=a.length&&(l=a.length-1);d.score=g+a[l];d.score-=2*d["c"+c+"-b"]}}}}());bgss.define("00068448",function(){function b(a,b,g){return a*a+b*b+g*g+7*Math.min(a,b,g)}function a(a){if(0===a.wild)return b(a.tablets,a.compasses,a.gears);if(1===a.wild)return Math.max(b(a.tablets+1,a.compasses,a.gears),b(a.tablets,a.compasses+1,a.gears),b(a.tablets,a.compasses,a.gears+1));if(2===a.wild)return Math.max(b(a.tablets+2,a.compasses,a.gears),b(a.tablets,a.compasses+2,a.gears),b(a.tablets,a.compasses,a.gears+2),b(a.tablets+1,a.compasses+1,a.gears),b(a.tablets+1,a.compasses,a.gears+1),
b(a.tablets,a.compasses+1,a.gears+1));if(3===a.wild)return Math.max(b(a.tablets+3,a.compasses,a.gears),b(a.tablets,a.compasses+3,a.gears),b(a.tablets,a.compasses,a.gears+3),b(a.tablets+2,a.compasses+1,a.gears),b(a.tablets+2,a.compasses,a.gears+1),b(a.tablets+1,a.compasses+2,a.gears),b(a.tablets,a.compasses+2,a.gears+1),b(a.tablets+1,a.compasses,a.gears+2),b(a.tablets,a.compasses+1,a.gears+2),b(a.tablets+1,a.compasses+1,a.gears+1));throw"unexpected wild: "+a.wild;}return{en:"7 Wonders",fr:"7 Wonders",
min:2,max:7,score:function(b,d){d.scientific=a(d);$("#scientific-"+d.id).text(d.scientific);d.score=0;d.score+=Math.floor(d.coins/3);d.score+=d.military;d.score+=d.wonder;d.score+=d.civilian;d.score+=d.commercial;d.score+=d.guild;d.score+=d.scientific;d.score+=d.extra}}}());bgss.define("00000050",function(){return{en:"Lost Cities",fr:"Les Cit&eacute;s Perdues",min:2,max:2,score:function(b,a){a.score=0;for(b=1;5>=b;b++){var c=0;a["exp"+b+"-c1"]&&c++;a["exp"+b+"-c2"]&&c++;a["exp"+b+"-c3"]&&c++;for(var d=c,g=0,l=2;10>=l;l++)a["exp"+b+"-"+l]&&(d++,g+=l);d?(g=(g-20)*(c+1),8<=d&&(g+=20),c=g):c=0;a["score"+b]=c;$("#score"+b+"-"+a.id).text(c);a.score+=c}}}}());bgss.define("00164928",function(){return{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5,score:function(b,a){a.score=0;a.score+=a.coins;a.score+=a.grain;a.score+=2*a.cheese;a.score+=3*a.wine;a.score+=4*a.wool;a.score+=5*a.brocade;a.score+=(a.citizens+a.stations)*a.development;a.score+=a.extra}}}());bgss.define("00193738",function(){return{en:"Great Western Trail",fr:"Great Western",min:2,max:4,score:function(b,a){a.score=0;a.score+=Math.floor(a.money/5);a.score+=a.buildings;a.score+=a.cities;a.score+=a.stations;a.score+=a.hazard;a.score+=a.cattle;a.score+=a.objective;a.score+=a.master;a.score+=4*a.workers;a.disc&&(a.score+=3);a.job&&(a.score+=2)}}}());bgss.define("00185343",function(){return{en:"Anachrony",fr:"Anachrony",min:1,max:4,score:function(b,a){a.score=0;a.score+=a.buildings;a.score+=a.projects;a.score-=3*a.anomalies;a.score+=a.travel;a.score+=a.morale;a.score+=a.breakthroughs1;a.score+=a.breakthroughs2;a.score+=a.breakthroughs3;a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3);a.score+=a.tokens;a.score-=2*a.warps;a.endgame1&&(a.score+=3);a.endgame2&&(a.score+=3);a.endgame3&&(a.score+=3);a.endgame4&&(a.score+=3);a.endgame5&&
(a.score+=3)}}}());bgss.define("00031260",function(){function b(a,b){a>=b.length&&(a=b.length-1);return b[a]}var a=[-1,-1,1,2,3,4],c=[-1,1,2,3,4],d=[-1,1,1,1,2,2,3,3,4],g=[-1,1,2,3,4],l=[-1,1,1,1,2,2,3,3,4],p=[-1,1,1,2,2,3,3,4],t=[-1,1,2,2,3,3,4];return{en:"Agricola",fr:"Agricola",min:1,max:5,score:function(u,f){f.score=0;f.score+=b(f.plowed,a);f.score+=b(f.pastures,c);f.score+=b(f.grain,d);f.score+=b(f.vegetables,g);f.score+=b(f.sheep,l);f.score+=b(f.boar,p);f.score+=b(f.cattle,t);f.score-=f.unused;f.score+=f.stables;
f.score+=f.clay;f.score+=2*f.stone;f.score+=3*f.family;f.score+=f.card;f.score+=f.bonus;f.score-=3*f.begging}}}());bgss.define("00258389",function(){return{en:"Futuropia",fr:"Futuropia",min:1,max:4,score:function(b,a){a.score=0;a.score+=5*a.people;a.score+=a.quarters;a.score+=Math.floor((a.energy+a.food+a.money)/10);b.variant1?(a.score-=a.loans,a.score+=a.actions):(a.score-=3*a.loans,a.score+=3*a.actions);b.variant2?(a.score+=2*a.xenergy,a.score+=2*a.xfood):(a.score+=a.xenergy,a.score+=a.xfood)}}}());bgss.define("00228959",function(){return{en:"Alubari",fr:"Alubari",min:2,max:5,score:function(b,a){a.score=0;a.score+=a.estates;a.score+=a.stations;a.score+=a.tracks;a.score+=a.contracts;a.score+=a.equipment;a.score+=a.chai;a.score+=a.tea/2}}}());bgss.define("00216132",function(){var b,a;return{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4,init:function(c){3<=c.players?(b=[12,6,0,0],a=[18,12,6,0]):(b=[8,0],a=[12,0])},common:function(c){var d=0+bgss.update_sum("cotton",.1);d+=bgss.update_sum("tobacco",.2);if(d+=bgss.update_sum("sugar",.3)){var g=["cotton","tobacco","sugar"];g.sort(function(a,b){return c.sum[a]>c.sum[b]?1:c.sum[a]<c.sum[b]?-1:0});c[g[0]]=5;c[g[1]]=4;c[g[2]]=3;$("#vp_cotton").text(c.cotton);$("#vp_tobacco").text(c.tobacco);
$("#vp_sugar").text(c.sugar)}d+=bgss.update_sum("contracts");d+=bgss.update_sum("settlements");bgss.update_majority("contracts",b);bgss.update_majority("settlements",a);return d},score:function(a,b){b.score=0;b.score+=b.glory;b.score+=b.basic;b.score+=2*b.processed;b.score+=Math.floor(b.money/10);b.score+=b.money%10/10;b.score+=b.hops;b.score+=b.cotton*a.cotton;b.score+=b.tobacco*a.tobacco;b.score+=b.sugar*a.sugar;b.score+=b.contracts_bonus;b.score+=b.settlements_bonus}}}());bgss.define("00124361",function(){return{en:"Concordia",fr:"Concordia",min:2,max:5,score:function(b,a){a.score=0;a.score+=Math.floor(a.money/10);a.score+=a.jupiter*a.houses;a.score+=a.saturnus*a.provinces;a.score+=a.mercurius*a.types;a.score+=a.mars*a.colonists;a.score+=3*a.brick;a.score+=3*a.food;a.score+=3*a.tool;a.score+=4*a.wine;a.score+=5*a.cloth;a.first&&(a.score+=7)}}}());bgss.define("00169786",function(){return{en:"Scythe",fr:"Scythe",min:1,max:7,score:function(b,a){a.score=0;a.score+=a.coins;6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):12>=a.popularity?(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*Math.floor(a.resources/2)):(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2));a.score+=a.bonus;a.score-=a.malus}}}());
