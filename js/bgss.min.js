var bgss=function(){function f(a){m.score(g[0],g[a]);var d=g[a].score;e.debug&&console.log("player "+a+" score:",d,g[a]);$("#score-"+a).is("input")?$("#score-"+a).val(d):$("#score-"+a).text(d);$("#result-"+a).text(d)}function a(a){var d=0;m.common&&(d+=m.common(g[0]));if(d)for(e.debug&&console.log("general:",g[0]),a=1;a<=e.players;a++)f(a);else f(a)}function b(a){var d=0;if("checkbox"==a.attr("type"))return a.prop("checked");if(a.hasClass("togglable"))return!a.hasClass("hollow");var b=a.val();if(!b)return 0;
var e=parseInt(b);e.toString()!=b&&d++;b=a.attr("min");"undefined"!==typeof b&&e<b&&(e=b,d++);b=a.attr("max");"undefined"!==typeof b&&e>b&&(e=b,d++);d&&a.val(e);return e}function c(a){var d=[];$.each(p,function(b,e){e[a]&&d.push([b,e[a]])});d.sort(function(a,d){return a[1]>d[1]?1:a[1]<d[1]?-1:0});$("#game").data(a,d)}function h(a,b){var d=a.clone().attr("id","player"+b),e;d.find("*").each(function(a){(e=$(this).attr("id"))&&$(this).attr("id",e+"-"+b);(e=$(this).attr("for"))&&$(this).attr("for",e+
"-"+b);(e=$(this).attr("data-index"))&&$(this).attr("data-index",b+e)});return d}function n(){$("select[data-init]").each(function(a){a=$(this).data("init").split("/").map(function(a){return parseInt(a)});for(var d=a[0];d<=a[2];d++){var b=$("<option>").attr("value",d).text(d);d==a[1]&&b.attr("selected","selected");$(this).append(b)}})}function k(){var d;for(d=0;d<=e.players;d++)g.push({id:d});g[0].sum={};var c=$("#tabs").children("li").last();for(d=e.players;1<=d;d--){var r=$("<a>").attr("href","#player"+
d).text(d),r=$("<li>").addClass("tabs-title").append(r);c.before(r);c=r}c=$("#_player_");for(d=1;d<=e.players;d++)$("#tabs-content").append(h(c,d));c.remove();$("#tabs").on("change.zf.tabs",function(){var a=$("#tabs-content").find(".tabs-panel.is-active").attr("id"),d=p[e.game][e.language];if(a&&a.startsWith("player")){var a=parseInt(a.substr(6)),b='<span id="score-'+a+'">'+g[a].score+"</span>";$("#title").html(d+" - "+e.player[a-1]+" = "+b)}else $("#title").html(d)});$("#tabs-content").find("input,select").each(function(d){if(d=
$(this).attr("id")){var c=d.substr(0,d.length-2),l=parseInt(d.substr(-1));g[l][c]=b($(this));"score"!=c&&$(this).change(function(){g[l][c]=b($(this));if($(this).hasClass("highlander")&&g[l][c])for(var d=1;d<=e.players;d++)d!=l&&g[d][c]&&$("#"+c+"-"+d).click();a(l)})}});$("#tabs-content").find("a.togglable").each(function(d){if(d=$(this).attr("id")){var e=d.substr(0,d.length-2),c=parseInt(d.substr(-1));g[c][e]=b($(this));$(this).click(function(){$(this).hasClass("hollow")?($(this).removeClass("hollow"),
g[c][e]=!0):($(this).addClass("hollow"),g[c][e]=!1);a(c)})}});for(d=1;d<=e.players;d++)a(d);Foundation.reInit($("#tabs"));$(".accordion").foundation()}function w(){$("#tabs-content").on("keydown","input",function(a){13==a.which&&(a.preventDefault(),a=$(a.target).attr("data-index"))&&(a=parseInt(a)+1,$("[data-index="+a+"]").focus())})}function y(){$("#language").change(function(){e.language=$(this).val();e.debug&&console.log("language changed:",e.language);u();q()});$("#game").change(function(){e.game=
$(this).val();e.debug&&console.log("game changed:",e.game);x();q()});$("#players").change(function(){e.players=$(this).val();e.debug&&console.log("players changed:",e.players);v();q()});$("#container").find("input").each(function(a){if((a=$(this).attr("id"))&&a.startsWith("player")){var d=parseInt(a.substr(6));$(this).change(function(){e.player[d-1]=$(this).val().trim();e.player[d-1]!=$(this).val()&&$(this).val(e.player[d-1]);e.debug&&console.log("player "+d+" changed:",e.player[d-1]);q()})}});$("#clear").click(function(){for(var a=
1;7>=a;a++)e.player[a-1]="",$("input#player"+a).val("");q()});$("#next").click(function(){var a=window.location,b=e.game+".html#language="+e.language+"&players="+e.players;e.debug&&(b+="&debug=1");for(var c=[],t=1;t<=e.players;t++)c.push(e.player[t-1]||t);b+="&names="+c.map(encodeURI).join(",");a.href=b})}function u(){var a="[lang="+e.language+"]";$("body").find("[lang]").not(a).hide();$("body").find(a).show();$("#container").find("select.langaware").each(function(a){var d=$(this);a=d.val();var b=
d.data(e.language);d.empty();$.each(b,function(a,b){d.append($("<option>").attr("value",b[0]).html(b[1]))});a&&d.val(a)})}function x(){var a=p[e.game];$("#players").children("option").each(function(b){b=$(this).attr("value");a.min<=b&&b<=a.max?$(this).show():$(this).hide()});var b=0;e.players<a.min?b=a.min:e.players>a.max&&(b=a.max);b&&(e.players=b,$("#players").val(e.players),v());a.min==a.max?$("#players").prop("disabled","disabled"):$("#players").prop("disabled",!1)}function v(){$("#container").children("div").each(function(a){(a=
$(this).attr("id"))&&a.startsWith("player")&&(parseInt(a.substr(6))<=e.players?$(this).show():$(this).hide())})}function z(){$("#language").val(e.language);u();$("#game").val(e.game);x();$("#players").val(e.players);v();$.each(e.player,function(a,b){$("input#player"+(a+1)).val(b)})}function q(){if("undefined"!==typeof Storage){e.debug&&console.log("store",e);var a={};$.each(e.player,function(b,d){a[d]=1});e.names&&$.each(e.names,function(b,d){a[d]=1});delete a[""];e.names=Object.keys(a);e.names.sort();
localStorage.setItem("bgss",JSON.stringify(e))}}function A(){var a=e.debug;if("undefined"!==typeof Storage){var b=localStorage.getItem("bgss");if(b){e=JSON.parse(b);"undefined"!==typeof a&&(e.debug=a);e.debug&&console.log("fetch",e);e.names&&$.each(e.names,function(a,b){$("datalist#names").append($("<option>").text(b))});return}}e={language:"en",game:"164928",players:4,player:"      ".split(" ")};"undefined"!==typeof a&&(e.debug=a)}function B(){e={language:"en",players:4,player:"1234567".split("")};
var a=window.location.hash;a.length&&$.each(a.substr(1).split("&"),function(a,b){var d=b.split("=");if(2!==d.length||"debug"!=d[0]&&"language"!=d[0]&&"players"!=d[0])if(2===d.length&&"names"==d[0])e.player=d[1].split(",").map(decodeURI);else throw"unexpected query: "+b;else e[d[0]]=d[1]});if(a=window.location.pathname.match(/(\d+)\.html$/))if(m=p[a[1]])e.game=a[1],$("#title").html(m[e.language]),document.title="BGSS - "+$("#title").text();else throw"unexpected game: "+a[1];else throw"unexpected pathname: "+
window.location.pathname;e.debug&&console.log("search",e)}var g=[],p={},e={},m;return{define:function(a,b){p[a]=b},update_majority:function(a,b){for(var d={},c=1;c<=e.players;c++)d[g[c][a]]||(d[g[c][a]]=[]),d[g[c][a]].push(c);c=Object.keys(d);c.sort(function(a,b){return parseInt(a)>parseInt(b)?-1:parseInt(a)<parseInt(b)?1:0});var f=0;$.each(c,function(e,c){var l=d[c],h=0,k;for(k=0;k<l.length;k++)h+=b[f++];h=Math.floor(h/l.length);for(k=0;k<l.length;k++)g[l[k]][a+"_bonus"]=h})},update_sum:function(a,
b){b=b||0;for(var d=1;d<=e.players;d++)b+=g[d][a];if(a in g[0].sum&&g[0].sum[a]==b)return 0;g[0].sum[a]=b;return 1},init_main:function(){var a=window.location.hash;a.length&&(a=a.match(/debug=(\d)/))&&(e.debug=parseInt(a[1]));c("en");c("fr");w();y();A();z()},init_game:function(){B();m.init&&m.init(e);for(var a=$("#results table tbody"),b=1;b<=e.players;b++){var c=$("<tr>");c.append($("<td>").html(e.player[b-1]));c.append($("<td>").attr("id","result-"+b).text("0"));a.append(c)}n();k();w();m.setup&&
m.setup(e);u();$("#tabs").children("li").first().click()}}}();bgss.define("124361",function(){return{en:"Concordia",fr:"Concordia",min:2,max:5,score:function(f,a){a.score=0;a.score+=Math.floor(a.money/10);a.score+=a.jupiter*a.houses;a.score+=a.saturnus*a.provinces;a.score+=a.mercurius*a.types;a.score+=a.mars*a.colonists;a.score+=3*a.brick;a.score+=3*a.food;a.score+=3*a.tool;a.score+=4*a.wine;a.score+=5*a.cloth;a.first&&(a.score+=7)}}}());bgss.define("164928",function(){return{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5,score:function(f,a){a.score=0;a.score+=a.coins;a.score+=a.grain;a.score+=2*a.cheese;a.score+=3*a.wine;a.score+=4*a.wool;a.score+=5*a.brocade;a.score+=(a.citizens+a.stations)*a.development;a.score+=a.extra}}}());bgss.define("193738",function(){return{en:"Great Western Trail",fr:"Great Western",min:2,max:4,score:function(f,a){a.score=0;a.score+=Math.floor(a.money/5);a.score+=a.buildings;a.score+=a.cities;a.score+=a.stations;a.score+=a.hazard;a.score+=a.cattle;a.score+=a.objective;a.score+=a.master;a.score+=4*a.workers;a.disc&&(a.score+=3);a.job&&(a.score+=2)}}}());bgss.define("185343",function(){return{en:"Anachrony",fr:"Anachrony",min:1,max:4,score:function(f,a){a.score=0;a.score+=a.buildings;a.score+=a.projects;a.score-=3*a.anomalies;a.score+=a.travel;a.score+=a.morale;a.score+=a.breakthroughs1;a.score+=a.breakthroughs2;a.score+=a.breakthroughs3;a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3);a.score+=a.tokens;a.score-=2*a.warps;a.endgame1&&(a.score+=3);a.endgame2&&(a.score+=3);a.endgame3&&(a.score+=3);a.endgame4&&(a.score+=3);a.endgame5&&
(a.score+=3)}}}());bgss.define("50",function(){return{en:"Lost Cities",fr:"Les Cit&eacute;s Perdues",min:2,max:2,score:function(f,a){var b;a.score=0;for(var c=1;5>=c;c++){b=0;a["exp"+c+"-c1"]&&b++;a["exp"+c+"-c2"]&&b++;a["exp"+c+"-c3"]&&b++;for(var h=b,n=0,k=2;10>=k;k++)a["exp"+c+"-"+k]&&(h++,n+=k);h?(n=(n-20)*(b+1),8<=h&&(n+=20),b=n):b=0;a["score"+c]=b;$("#score"+c+"-"+a.id).text(b);a.score+=b}}}}());bgss.define("216132",function(){var f,a;return{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4,init:function(b){3<=b.players?(f=[12,6,0,0],a=[18,12,6,0]):(f=[8,0],a=[12,0])},common:function(b){var c;c=0+bgss.update_sum("cotton",.1);c+=bgss.update_sum("tobacco",.2);if(c+=bgss.update_sum("sugar",.3)){var h=["cotton","tobacco","sugar"];h.sort(function(a,c){return b.sum[a]>b.sum[c]?1:b.sum[a]<b.sum[c]?-1:0});b[h[0]]=5;b[h[1]]=4;b[h[2]]=3;$("#vp_cotton").text(b.cotton);$("#vp_tobacco").text(b.tobacco);
$("#vp_sugar").text(b.sugar)}c+=bgss.update_sum("contracts");c+=bgss.update_sum("settlements");bgss.update_majority("contracts",f);bgss.update_majority("settlements",a);return c},score:function(a,c){c.score=0;c.score+=c.glory;c.score+=c.basic;c.score+=2*c.processed;c.score+=Math.floor(c.money/10);c.score+=c.money%10/10;c.score+=c.hops;c.score+=c.cotton*a.cotton;c.score+=c.tobacco*a.tobacco;c.score+=c.sugar*a.sugar;c.score+=c.contracts_bonus;c.score+=c.settlements_bonus}}}());bgss.define("31260",function(){function f(a,b){a>=b.length&&(a=b.length-1);return b[a]}return{en:"Agricola",fr:"Agricola",min:1,max:5,score:function(a,b){b.score=0;b.score+=f(b.plowed,[-1,-1,1,2,3,4]);b.score+=f(b.pastures,[-1,1,2,3,4]);b.score+=f(b.grain,[-1,1,1,1,2,2,3,3,4]);b.score+=f(b.vegetables,[-1,1,2,3,4]);b.score+=f(b.sheep,[-1,1,1,1,2,2,3,3,4]);b.score+=f(b.boar,[-1,1,1,2,2,3,3,4]);b.score+=f(b.cattle,[-1,1,2,2,3,3,4]);b.score-=b.unused;b.score+=b.stables;b.score+=b.clay;b.score+=2*b.stone;
b.score+=3*b.family;b.score+=b.card;b.score+=b.bonus;b.score-=3*b.begging}}}());bgss.define("215471",function(){var f,a=[-3,1,3,4,7,8,10,11];return{en:"Wind the Film!",fr:"Wind the Film!",min:2,max:4,init:function(a){f=2==a.players?5:3==a.players?6:7},setup:function(a){7>f&&$(".color7").hide();6>f&&$(".color6").hide()},score:function(b,c){c.score=0;for(var h=1;h<=f;h++){c["c"+h+"-g"]&&(c.score+=5);var n=c.score,k=c["c"+h+"-s"];k>=a.length&&(k=a.length-1);c.score=n+a[k];c.score-=2*c["c"+h+"-b"]}}}}());bgss.define("169786",function(){return{en:"Scythe",fr:"Scythe",min:1,max:5,score:function(f,a){a.score=0;a.score+=a.coins;6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):13<=a.popularity?(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2)):(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*Math.floor(a.resources/2));a.score+=a.bonus}}}());
