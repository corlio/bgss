var bgss=function(){function g(a){n.score(k[0],k[a]);var f=k[a].score;d.debug&&console.log("player "+a+" score:",f,k[a]);$("#score-"+a).is("input")?$("#score-"+a).val(f):$("#score-"+a).text(f);$("#result-"+a).text(f)}function a(a){var f=0;n.common&&(f+=n.common(k[0]));if(f)for(d.debug&&console.log("general:",k[0]),a=1;a<=d.players;a++)g(a);else g(a)}function b(a){var f=0;if("checkbox"==a.attr("type"))return a.prop("checked");if(a.hasClass("togglable"))return!a.hasClass("hollow");var b=a.val();if(!b)return 0;
var c=parseInt(b);c.toString()!=b&&f++;b=a.attr("min");"undefined"!==typeof b&&c<b&&(c=b,f++);b=a.attr("max");"undefined"!==typeof b&&c>b&&(c=b,f++);f&&a.val(c);return c}function c(a){var b=[];$.each(p,function(f,c){c[a]&&b.push([f,c[a]])});b.sort(function(a,b){return a[1]>b[1]?1:a[1]<b[1]?-1:0});$("#game").data(a,b)}function h(a,b){var f=a.clone().attr("id","player"+b),c;f.find("*").each(function(a){(c=$(this).attr("id"))&&$(this).attr("id",c+"-"+b);(c=$(this).attr("for"))&&$(this).attr("for",c+
"-"+b);(c=$(this).attr("data-index"))&&$(this).attr("data-index",b+c)});return f}function m(){$("select[data-init]").each(function(a){a=$(this).data("init").split("/").map(function(a){return parseInt(a)});for(var b=a[0];b<=a[2];b++){var f=$("<option>").attr("value",b).text(b);b==a[1]&&f.attr("selected","selected");$(this).append(f)}})}function l(){var f;for(f=0;f<=d.players;f++)k.push({id:f});k[0].sum={};var c=$("#tabs").children("li").last();for(f=d.players;1<=f;f--){var e=$("<a>").attr("href","#player"+
f).text(f),e=$("<li>").addClass("tabs-title").append(e);c.before(e);c=e}c=$("#_player_");for(f=1;f<=d.players;f++)$("#tabs-content").append(h(c,f));c.remove();$("#tabs").on("change.zf.tabs",function(){var a=$("#tabs-content").find(".tabs-panel.is-active").attr("id"),b=p[d.game][d.language];if(a&&a.startsWith("player")){var a=parseInt(a.substr(6)),f='<span id="score-'+a+'">'+k[a].score+"</span>";$("#title").html(b+" - "+d.player[a-1]+" = "+f)}else $("#title").html(b)});$("#tabs-content").find("input,select").each(function(f){if(f=
$(this).attr("id")){var c=f.substr(0,f.length-2),e=parseInt(f.substr(-1));k[e][c]=b($(this));"score"!=c&&$(this).change(function(){k[e][c]=b($(this));if($(this).hasClass("highlander")&&k[e][c])for(var f=1;f<=d.players;f++)f!=e&&k[f][c]&&$("#"+c+"-"+f).click();a(e)})}});$("#tabs-content").find("a.togglable").each(function(f){if(f=$(this).attr("id")){var c=f.substr(0,f.length-2),d=parseInt(f.substr(-1));k[d][c]=b($(this));$(this).click(function(){$(this).hasClass("hollow")?($(this).removeClass("hollow"),
k[d][c]=!0):($(this).addClass("hollow"),k[d][c]=!1);a(d)})}});for(f=1;f<=d.players;f++)a(f);Foundation.reInit($("#tabs"));$(".accordion").foundation()}function r(){$("body").on("keydown","input",function(a){13==a.which&&(a.preventDefault(),a=$(a.target).attr("data-index"))&&(a=parseInt(a)+1,$("[data-index="+a+"]").focus())})}function u(){$("#language").change(function(){d.language=$(this).val();d.debug&&console.log("language changed:",d.language);e();q()});$("#game").change(function(){d.game=$(this).val();
d.debug&&console.log("game changed:",d.game);v();q()});$("#players").change(function(){d.players=$(this).val();d.debug&&console.log("players changed:",d.players);t();q()});$("body").find("input").each(function(a){if((a=$(this).attr("id"))&&a.startsWith("player")){var b=parseInt(a.substr(6));$(this).change(function(){d.player[b-1]=$(this).val().trim();d.player[b-1]!=$(this).val()&&$(this).val(d.player[b-1]);d.debug&&console.log("player "+b+" changed:",d.player[b-1]);q()})}});$("#clear").click(function(){for(var a=
1;7>=a;a++)d.player[a-1]="",$("input#player"+a).val("");q()});$("#next").click(function(){var a=window.location,b=d.game+".html#language="+d.language+"&players="+d.players;d.debug&&(b+="&debug=1");for(var c=[],e=1;e<=d.players;e++)c.push(d.player[e-1]||e);b+="&names="+c.map(encodeURI).join(",");a.href=b})}function e(){var a="[lang="+d.language+"]";$("body").find("[lang]").not(a).hide();$("body").find(a).show();$("body").find("select.langaware").each(function(a){var b=$(this);a=b.val();var c=b.data(d.language);
b.empty();$.each(c,function(a,c){b.append($("<option>").attr("value",c[0]).html(c[1]))});a&&b.val(a)})}function v(){var a=p[d.game];$("#players").children("option").each(function(b){b=$(this).attr("value");a.min<=b&&b<=a.max?$(this).show():$(this).hide()});var b=0;d.players<a.min?b=a.min:d.players>a.max&&(b=a.max);b&&(d.players=b,$("#players").val(d.players),t());a.min==a.max?$("#players").prop("disabled","disabled"):$("#players").prop("disabled",!1)}function t(){$("body").find("div").each(function(a){(a=
$(this).attr("id"))&&a.startsWith("player")&&(parseInt(a.substr(6))<=d.players?$(this).show():$(this).hide())})}function w(){$("#language").val(d.language);e();$("#game").val(d.game);v();$("#players").val(d.players);t();$.each(d.player,function(a,b){$("input#player"+(a+1)).val(b)})}function q(){if("undefined"!==typeof Storage){d.debug&&console.log("store",d);var a={};$.each(d.player,function(b,c){a[c]=1});d.names&&$.each(d.names,function(b,c){a[c]=1});delete a[""];d.names=Object.keys(a);d.names.sort();
localStorage.setItem("bgss",JSON.stringify(d))}}function x(){var a=d.debug;if("undefined"!==typeof Storage){var b=localStorage.getItem("bgss");if(b){d=JSON.parse(b);"undefined"!==typeof a&&(d.debug=a);d.debug&&console.log("fetch",d);d.names&&$.each(d.names,function(a,b){$("datalist#names").append($("<option>").text(b))});return}}d={language:"en",game:"164928",players:4,player:"      ".split(" ")};"undefined"!==typeof a&&(d.debug=a)}function y(){d={language:"en",players:4,player:"1234567".split("")};
var a=window.location.hash;a.length&&$.each(a.substr(1).split("&"),function(a,b){var c=b.split("=");if(2!==c.length||"debug"!=c[0]&&"language"!=c[0]&&"players"!=c[0])if(2===c.length&&"names"==c[0])d.player=c[1].split(",").map(decodeURI);else throw"unexpected query: "+b;else d[c[0]]=c[1]});if(a=window.location.pathname.match(/(\d+)\.html$/))if(n=p[a[1]])d.game=a[1],$("#title").html(n[d.language]),document.title="BGSS - "+$("#title").text();else throw"unexpected game: "+a[1];else throw"unexpected pathname: "+
window.location.pathname;d.debug&&console.log("search",d)}var k=[],p={},d={},n;return{define:function(a,b){p[a]=b},update_majority:function(a,b){for(var c={},e=1;e<=d.players;e++)c[k[e][a]]||(c[k[e][a]]=[]),c[k[e][a]].push(e);e=Object.keys(c);e.sort(function(a,b){return parseInt(a)>parseInt(b)?-1:parseInt(a)<parseInt(b)?1:0});var f=0;$.each(e,function(d,e){var g=c[e],h=0,l;for(l=0;l<g.length;l++)h+=b[f++];h=Math.floor(h/g.length);for(l=0;l<g.length;l++)k[g[l]][a+"_bonus"]=h})},update_sum:function(a,
b){b=b||0;for(var c=1;c<=d.players;c++)b+=k[c][a];if(a in k[0].sum&&k[0].sum[a]==b)return 0;k[0].sum[a]=b;return 1},init_main:function(){var a=window.location.hash;a.length&&(a=a.match(/debug=(\d)/))&&(d.debug=parseInt(a[1]));c("en");c("fr");r();u();x();w()},init_game:function(){y();n.init&&n.init(d);for(var a=$("#results table tbody"),b=1;b<=d.players;b++){var c=$("<tr>");c.append($("<td>").html(d.player[b-1]));c.append($("<td>").attr("id","result-"+b).text("0"));a.append(c)}m();l();r();n.setup&&
n.setup(d);e();$("#tabs").children("li").first().click()}}}();bgss.define("50",function(){return{en:"Lost Cities",fr:"Les Cit&eacute;s Perdues",min:2,max:2,score:function(g,a){a.score=0;for(var b=1;5>=b;b++){var c;c=0;a["exp"+b+"-c1"]&&c++;a["exp"+b+"-c2"]&&c++;a["exp"+b+"-c3"]&&c++;for(var h=c,m=0,l=2;10>=l;l++)a["exp"+b+"-"+l]&&(h++,m+=l);h?(m=(m-20)*(c+1),8<=h&&(m+=20),c=m):c=0;a["score"+b]=c;$("#score"+b+"-"+a.id).text(c);a.score+=c}}}}());bgss.define("124361",function(){return{en:"Concordia",fr:"Concordia",min:2,max:5,score:function(g,a){a.score=0;a.score+=Math.floor(a.money/10);a.score+=a.jupiter*a.houses;a.score+=a.saturnus*a.provinces;a.score+=a.mercurius*a.types;a.score+=a.mars*a.colonists;a.score+=3*a.brick;a.score+=3*a.food;a.score+=3*a.tool;a.score+=4*a.wine;a.score+=5*a.cloth;a.first&&(a.score+=7)}}}());bgss.define("164928",function(){return{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5,score:function(g,a){a.score=0;a.score+=a.coins;a.score+=a.grain;a.score+=2*a.cheese;a.score+=3*a.wine;a.score+=4*a.wool;a.score+=5*a.brocade;a.score+=(a.citizens+a.stations)*a.development;a.score+=a.extra}}}());bgss.define("193738",function(){return{en:"Great Western Trail",fr:"Great Western",min:2,max:4,score:function(g,a){a.score=0;a.score+=Math.floor(a.money/5);a.score+=a.buildings;a.score+=a.cities;a.score+=a.stations;a.score+=a.hazard;a.score+=a.cattle;a.score+=a.objective;a.score+=a.master;a.score+=4*a.workers;a.disc&&(a.score+=3);a.job&&(a.score+=2)}}}());bgss.define("185343",function(){return{en:"Anachrony",fr:"Anachrony",min:1,max:4,score:function(g,a){a.score=0;a.score+=a.buildings;a.score+=a.projects;a.score-=3*a.anomalies;a.score+=a.travel;a.score+=a.morale;a.score+=a.breakthroughs1;a.score+=a.breakthroughs2;a.score+=a.breakthroughs3;a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3);a.score+=a.tokens;a.score-=2*a.warps;a.endgame1&&(a.score+=3);a.endgame2&&(a.score+=3);a.endgame3&&(a.score+=3);a.endgame4&&(a.score+=3);a.endgame5&&
(a.score+=3)}}}());bgss.define("68448",function(){function g(a,b,c){return a*a+b*b+c*c+7*Math.min(a,b,c)}return{en:"7 Wonders",fr:"7 Wonders",min:2,max:7,score:function(a,b){var c;if(0===b.wild)c=g(b.tablets,b.compasses,b.gears);else if(1===b.wild)c=Math.max(g(b.tablets+1,b.compasses,b.gears),g(b.tablets,b.compasses+1,b.gears),g(b.tablets,b.compasses,b.gears+1));else if(2===b.wild)c=Math.max(g(b.tablets+2,b.compasses,b.gears),g(b.tablets,b.compasses+2,b.gears),g(b.tablets,b.compasses,b.gears+2),g(b.tablets+1,b.compasses+
1,b.gears),g(b.tablets+1,b.compasses,b.gears+1),g(b.tablets,b.compasses+1,b.gears+1));else throw"unexpected wild: "+b.wild;b.scientific=c;$("#scientific-"+b.id).text(b.scientific);b.score=0;b.score+=Math.floor(b.coins/3);b.score+=b.military;b.score+=b.wonder;b.score+=b.civilian;b.score+=b.commercial;b.score+=b.guild;b.score+=b.scientific;b.score+=b.extra}}}());bgss.define("216132",function(){var g,a;return{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4,init:function(b){3<=b.players?(g=[12,6,0,0],a=[18,12,6,0]):(g=[8,0],a=[12,0])},common:function(b){var c;c=0+bgss.update_sum("cotton",.1);c+=bgss.update_sum("tobacco",.2);if(c+=bgss.update_sum("sugar",.3)){var h=["cotton","tobacco","sugar"];h.sort(function(a,c){return b.sum[a]>b.sum[c]?1:b.sum[a]<b.sum[c]?-1:0});b[h[0]]=5;b[h[1]]=4;b[h[2]]=3;$("#vp_cotton").text(b.cotton);$("#vp_tobacco").text(b.tobacco);
$("#vp_sugar").text(b.sugar)}c+=bgss.update_sum("contracts");c+=bgss.update_sum("settlements");bgss.update_majority("contracts",g);bgss.update_majority("settlements",a);return c},score:function(a,c){c.score=0;c.score+=c.glory;c.score+=c.basic;c.score+=2*c.processed;c.score+=Math.floor(c.money/10);c.score+=c.money%10/10;c.score+=c.hops;c.score+=c.cotton*a.cotton;c.score+=c.tobacco*a.tobacco;c.score+=c.sugar*a.sugar;c.score+=c.contracts_bonus;c.score+=c.settlements_bonus}}}());bgss.define("31260",function(){function g(a,b){a>=b.length&&(a=b.length-1);return b[a]}var a=[-1,-1,1,2,3,4],b=[-1,1,2,3,4],c=[-1,1,1,1,2,2,3,3,4],h=[-1,1,2,3,4],m=[-1,1,1,1,2,2,3,3,4],l=[-1,1,1,2,2,3,3,4],r=[-1,1,2,2,3,3,4];return{en:"Agricola",fr:"Agricola",min:1,max:5,score:function(u,e){e.score=0;e.score+=g(e.plowed,a);e.score+=g(e.pastures,b);e.score+=g(e.grain,c);e.score+=g(e.vegetables,h);e.score+=g(e.sheep,m);e.score+=g(e.boar,l);e.score+=g(e.cattle,r);e.score-=e.unused;e.score+=e.stables;
e.score+=e.clay;e.score+=2*e.stone;e.score+=3*e.family;e.score+=e.card;e.score+=e.bonus;e.score-=3*e.begging}}}());bgss.define("215471",function(){var g,a=[-3,1,3,4,7,8,10,11];return{en:"Wind the Film!",fr:"Wind the Film!",min:2,max:4,init:function(a){g=2==a.players?5:3==a.players?6:7},setup:function(a){7>g&&$(".color7").hide();6>g&&$(".color6").hide()},score:function(b,c){c.score=0;for(var h=1;h<=g;h++)if(h==c.regret)$("#player1 .color"+h).hide();else{$("#player1 .color"+h).show();c["c"+h+"-g"]&&(c.score+=5);var m=c.score,l=c["c"+h+"-s"];l>=a.length&&(l=a.length-1);c.score=m+a[l];c.score-=2*c["c"+h+"-b"]}}}}());bgss.define("169786",function(){return{en:"Scythe",fr:"Scythe",min:1,max:5,score:function(g,a){a.score=0;a.score+=a.coins;6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):13<=a.popularity?(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2)):(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*Math.floor(a.resources/2));a.score+=a.bonus}}}());
