var bgss=(function(){var f=[];var e={"185343":{en:"Anachrony",fr:"Anachrony",min:1,max:4},"216132":{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4},"124361":{en:"Concordia",fr:"Concordia",min:2,max:5},"193738":{en:"Great Western Trail",fr:"Great Western",min:2,max:4},"164928":{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5}};var o={};var l={};function i(E,F){var D={};for(var H=1;H<=o.players;H++){if(!D[f[H][E]]){D[f[H][E]]=[]}D[f[H][E]].push(H)}var C=Object.keys(D);C.sort(function(J,I){if(parseInt(J)>parseInt(I)){return(-1)}if(parseInt(J)<parseInt(I)){return(+1)}return(0)});var G=0;$.each(C,function(I,K){var J=D[K];var M=0;var L;for(L=0;L<J.length;L++){M+=F[G++]}M=Math.floor(M/J.length);for(L=0;L<J.length;L++){f[J[L]][E+"_bonus"]=M}})}function h(C,D){D=D||0;for(var E=1;E<=o.players;E++){D+=f[E][C]}if(C in l&&l[C]==D){return(0)}l[C]=D;return(1)}function g(D){if(D.attr("type")=="checkbox"){return(D.prop("checked"))}var E=D.val();if(!E){return(0)}var C=parseInt(E);if(C.toString()!=E){D.val(C)}return(C)}function b(D){var C=[];$.each(e,function(F,E){if(!E[D]){return}C.push([F,E[D]])});C.sort(function(F,E){if(F[1]>E[1]){return(+1)}if(F[1]<E[1]){return(-1)}return(0)});$("#game").data(D,C)}function y(D,F){var E=D.clone().attr("id","player"+F);var C;E.find("*").each(function(G){C=$(this).attr("id");if(C){$(this).attr("id",C+"-"+F)}C=$(this).attr("for");if(C){$(this).attr("for",C+"-"+F)}C=$(this).attr("data-index");if(C){$(this).attr("data-index",F+C)}});return(E)}function p(F){var G;for(G=0;G<=o.players;G++){f.push({})}var D=$("#tabs").children("li").last();for(G=o.players;G>=1;G--){var C=$("<a>").attr("href","#player"+G).text(G);var E=$("<li>").addClass("tabs-title").append(C);D.before(E);D=E}D=$("#_player_");for(G=1;G<=o.players;G++){$("#tabs-content").append(y(D,G))}D.remove();$("#tabs").on("change.zf.tabs",function(){var J=$("#tabs-content").find(".tabs-panel.is-active").attr("id");var H=e[o.game][o.language];if(J&&J.startsWith("player")){var I=parseInt(J.substr(6));$("#title").html(H+" - "+o.player[I-1])}else{$("#title").html(H)}});$("#tabs-content").find("input,select").each(function(I){var K=$(this).attr("id");if(K){var H=K.substr(0,K.length-2);var J=parseInt(K.substr(-1));f[J][H]=g($(this));if(H=="score"){return}$(this).change(function(){f[J][H]=g($(this));F(J)})}});Foundation.reInit($("#tabs"))}function B(){var C=$("#results table tbody");for(var E=1;E<=o.players;E++){var D=$("<tr>");D.append($("<td>").html(o.player[E-1]));D.append($("<td>").attr("id","result-"+E).text("0"));C.append(D)}}function m(){$("form").on("keydown","input",function(F){if(F.which==13){F.preventDefault();var C=$(F.target);var D=C.attr("data-index");if(D){var E=parseInt(D)+1;$("[data-index="+E+"]").focus()}}})}function n(){var C="[lang="+o.language+"]";$("body").find("[lang]").not(C).hide();$("body").find(C).show();$("#container").find("select.langaware").each(function(F){var D=$(this);var G=D.val();var E=D.data(o.language);D.empty();$.each(E,function(I,H){D.append($("<option>").attr("value",H[0]).html(H[1]))});if(G){D.val(G)}})}function d(){var C=e[o.game];$("#players").children("option").each(function(D){var E=$(this).attr("value");if(C.min<=E&&E<=C.max){$(this).show()}else{$(this).hide()}})}function c(){$("#container").children("div").each(function(C){var E=$(this).attr("id");if(E&&E.startsWith("player")){var D=parseInt(E.substr(6));if(D<=o.players){$(this).show()}else{$(this).hide()}}})}function r(C){}function x(){$("#tabs").children("li").first().click()}function q(){$("#language").val(o.language);n();$("#game").val(o.game);d();$("#players").val(o.players);c();$.each(o.player,function(D,C){var E=D+1;$("input#player"+E).val(C);r(E)})}function u(){if(typeof(Storage)!=="undefined"){console.log("store",o);localStorage.setItem("bgss",JSON.stringify(o))}}function j(){if(typeof(Storage)!=="undefined"){var C=localStorage.getItem("bgss");if(C){o=JSON.parse(C);console.log("fetch",o);return}}o={language:"en",game:"164928",players:4,player:["","","","","","",""]}}function t(){o={language:"en",players:4,player:["1","2","3","4","5","6","7"]};var E=window.location.hash;if(E.length){$.each(E.substr(1).split("&"),function(F,H){var G=H.split("=");if(G.length===2&&(G[0]=="language"||G[0]=="players")){o[G[0]]=G[1]}else{if(G.length===2&&G[0]=="names"){o.player=G[1].split(",").map(decodeURI)}else{throw ("unexpected query: "+H)}}})}var D=window.location.pathname.match(/(\d+)\.html$/);if(D){var C=e[D[1]];if(C){o.game=D[1];$("#title").html(C[o.language]);document.title="BGSS - "+$("#title").text()}else{throw ("unexpected game: "+D[1])}}else{throw ("unexpected pathname: "+window.location.pathname)}console.log("search",o)}function A(C,F){var D=f[F];if(!D[C]){return}for(var E=1;E<=o.players;E++){if(E!=F&&f[E][C]){$("#"+C+"-"+E).click()}}}function w(D){var C=f[D];C.score=0;C.score+=C.buildings;C.score+=C.projects;C.score+=C.anomalies*-3;C.score+=C.travel;C.score+=C.morale;C.score+=C.breakthroughs1;C.score+=C.breakthroughs2;C.score+=C.breakthroughs3;C.score+=Math.min(C.breakthroughs1,C.breakthroughs2,C.breakthroughs3)*2;C.score+=C.tokens;C.score+=C.warps*-2;if(C.endgame1){C.score+=3}if(C.endgame2){C.score+=3}if(C.endgame3){C.score+=3}if(C.endgame4){C.score+=3}if(C.endgame5){C.score+=3}console.log("player "+D+" score:",C.score,C);$("#score-"+D).val(C.score);$("#result-"+D).text(C.score)}function v(F){var E=0;E+=h("cotton",0.1);E+=h("tobacco",0.2);E+=h("sugar",0.3);if(E){var D=["cotton","tobacco","sugar"];D.sort(function(H,G){if(l[H]>l[G]){return(+1)}if(l[H]<l[G]){return(-1)}return(0)});f[0][D[0]]=5;f[0][D[1]]=4;f[0][D[2]]=3}E+=h("contracts");E+=h("settlements");if(o.players>=3){i("contracts",[12,6,0,0]);i("settlements",[18,12,6,0])}else{i("contracts",[8,0]);i("contracts",[12,0])}if(E||!F){console.log("general",f[0]);for(var C=1;C<=o.players;C++){k(C)}}else{k(F)}}function k(D){var C=f[D];C.score=0;C.score+=C.glory;C.score+=C.basic;C.score+=C.processed*2;C.score+=Math.floor(C.money/10);C.score+=(C.money%10)/10;C.score+=C.hops;C.score+=C.cotton*f[0].cotton;C.score+=C.tobacco*f[0].tobacco;C.score+=C.sugar*f[0].sugar;C.score+=C.contracts_bonus;C.score+=C.settlements_bonus;console.log("player "+D+" score:",C.score,C);$("#score-"+D).val(C.score);$("#result-"+D).text(C.score)}function s(D){var C=f[D];A("first",D);C.score=0;C.score+=Math.floor(C.money/10);C.score+=C.jupiter*C.houses;C.score+=C.saturnus*C.provinces;C.score+=C.mercurius*C.types;C.score+=C.mars*C.colonists;C.score+=C.brick*3;C.score+=C.food*3;C.score+=C.tool*3;C.score+=C.wine*4;C.score+=C.cloth*5;if(C.first){C.score+=7}console.log("player "+D+" score:",C.score,C);$("#score-"+D).val(C.score);$("#result-"+D).text(C.score)}function z(D){var C=f[D];A("job",D);C.score=0;C.score+=Math.floor(C.money/5);C.score+=C.buildings;C.score+=C.cities;C.score+=C.stations;C.score+=C.hazard;C.score+=C.cattle;C.score+=C.objective;C.score+=C.master;C.score+=C.workers*4;if(C.disc){C.score+=3}if(C.job){C.score+=2}console.log("player "+D+" score:",C.score,C);$("#score-"+D).val(C.score);$("#result-"+D).text(C.score)}function a(D){var C=f[D];C.score=0;C.score+=C.coins;C.score+=C.grain;C.score+=C.cheese*2;C.score+=C.wine*3;C.score+=C.wool*4;C.score+=C.brocade*5;C.score+=(C.citizens+C.stations)*C.development;console.log("player "+D+" score:",C.score,C);$("#score-"+D).val(C.score);$("#result-"+D).text(C.score)}return({init_main:function(){b("en");b("fr");m();$("#language").change(function(){o.language=$(this).val();console.log("language changed:",o.language);n();u()});$("#game").change(function(){o.game=$(this).val();console.log("game changed:",o.game);d();u()});$("#players").change(function(){o.players=$(this).val();console.log("players changed:",o.players);c();u()});$("#container").find("input").each(function(C){var E=$(this).attr("id");if(E&&E.startsWith("player")){var D=parseInt(E.substr(6));$(this).change(function(){o.player[D-1]=$(this).val().trim();console.log("player "+D+" changed:",o.player[D-1]);r(D);u()})}});$("#clear").click(function(){for(var C=1;C<=7;C++){o.player[C-1]="";$("input#player"+C).val("");r(C)}u()});$("#next").click(function(){var D=[];for(var E=1;E<=o.players;E++){D.push(o.player[E-1]||E)}var C=o.game+".html#language="+o.language+"&players="+o.players+"&names="+D.map(encodeURI).join(",");window.location.href=C});j();q()},init_124361:function(){t();B();p(s);m();n();x()},init_164928:function(){t();B();p(a);m();n();x()},init_185343:function(){t();B();p(w);m();n();x()},init_193738:function(){t();B();p(z);m();n();x()},init_216132:function(){t();B();p(v);m();n();x();v(0)}})})();