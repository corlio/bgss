var bgss=function(){function g(){var a=new Date;return a.getFullYear()+"/"+("0"+(a.getMonth()+1)).substr(-2)+"/"+("0"+a.getDate()).substr(-2)+"-"+("0"+a.getHours()).substr(-2)+":"+("0"+a.getMinutes()).substr(-2)+":"+("0"+a.getSeconds()).substr(-2)}function a(a){p.score(h[0],h[a]);var f=h[a].score;d.debug&&console.log("player "+a+" score:",f,h[a]);$("#score-"+a).is("input")?$("#score-"+a).val(f):$("#score-"+a).text(f);$("#result-"+a).text(f)}function b(f){var b=0;p.common&&(b+=p.common(h[0]));if(b)for(d.debug&&
console.log("general:",h[0]),f=1;f<=d.players;f++)a(f);else a(f);var b={},c=0;for(f=1;f<=d.players;f++)h[f].score in b?c++:b[h[f].score]=1;c?$("#tie").show():$("#tie").hide();$("#date").text(g())}function c(a){var f=0;if("checkbox"==a.attr("type"))return a.prop("checked");if(a.hasClass("togglable"))return!a.hasClass("hollow");var b=a.val();if(!b)return 0;var c;c=b.startsWith(".")?-parseInt(b.substr(1)):parseInt(b);c.toString()!=b&&f++;b=a.attr("min");"undefined"!==typeof b&&c<b&&(c=b,f++);b=a.attr("max");
"undefined"!==typeof b&&c>b&&(c=b,f++);f&&a.val(c);return c}function k(a){var b=[];$.each(r,function(f,c){c[a]&&b.push([f,c[a]])});b.sort(function(a,b){return a[1]>b[1]?1:a[1]<b[1]?-1:0});$("#game").data(a,b)}function m(a,b){var f=a.clone().attr("id","player"+b),c,d;f.find("*").each(function(a){(c=$(this).attr("id"))&&$(this).attr("id",c+"-"+b);(c=$(this).attr("for"))&&$(this).attr("for",c+"-"+b)});d=1;f.find("input").each(function(a){$(this).attr("data-index",b+("0"+d).substr(-2));a=$(this).attr("min");
var f=$(this).attr("max");"undefined"!==typeof a&&"undefined"!==typeof f&&$(this).attr("placeholder",a+"-"+f);"undefined"===typeof a||"0"===a||$(this).attr("value")||$(this).attr("value",a);d++});return f}function l(){$("select[data-init]").each(function(a){a=$(this).data("init").split("/").map(function(a){return parseInt(a)});for(var b=a[0];b<=a[2];b++){var f=$("<option>").attr("value",b).text(b);b==a[1]&&f.attr("selected","selected");$(this).append(f)}})}function v(){var a;for(a=0;a<=d.players;a++)h.push({id:a});
h[0].sum={};var e=$("#tabs").children("li").last();for(a=d.players;1<=a;a--){var u=$("<a>").attr("href","#player"+a).text(a),u=$("<li>").addClass("tabs-title").append(u);e.before(u);e=u}e=$("#_player_");for(a=1;a<=d.players;a++)$("#tabs-content").append(m(e,a));e.remove();$("#tabs").on("change.zf.tabs",function(){var a=$("#tabs-content").find(".tabs-panel.is-active").attr("id"),b=r[d.game][d.language];if(a&&a.startsWith("player")){var a=parseInt(a.substr(6)),f='<span id="score-'+a+'">'+h[a].score+
"</span>";$("#title").html(b+" - "+d.player[a-1]+" = "+f)}else $("#title").html(b)});$("#tabs-content").find("input,select").each(function(a){var f=$(this).attr("id");if(f){var e=f.substr(0,f.length-2),q=parseInt(f.substr(-1));f in n&&("checkbox"==$(this).attr("type")?n[f]?$(this).prop("checked",!0):$(this).prop("checked",!1):$(this).val(n[f]));h[q][e]=c($(this));$(this).change(function(){h[q][e]=c($(this));if($(this).hasClass("highlander")&&h[q][e])for(var a=1;a<=d.players;a++)a!=q&&h[a][e]&&$("#"+
e+"-"+a).click();n[f]=h[q][e];z();b(q)})}});$("#tabs-content").find("a.togglable").each(function(a){var f=$(this).attr("id");if(f){var d=f.substr(0,f.length-2),e=parseInt(f.substr(-1));f in n&&(n[f]?$(this).removeClass("hollow"):$(this).addClass("hollow"));h[e][d]=c($(this));$(this).click(function(){$(this).hasClass("hollow")?($(this).removeClass("hollow"),h[e][d]=!0):($(this).addClass("hollow"),h[e][d]=!1);n[f]=h[e][d];z();b(e)})}});for(a=1;a<=d.players;a++)b(a);Foundation.reInit($("#tabs"));$(".accordion").foundation()}
function w(){$("body").on("keydown","input",function(a){13==a.which&&(a.preventDefault(),a=$(a.target).attr("data-index"))&&(a=parseInt(a)+1,$("[data-index="+a+"]").focus())})}function e(){$("#language").change(function(){d.language=$(this).val();d.debug&&console.log("language changed:",d.language);x();t()});$("#game").change(function(){d.game=$(this).val();d.debug&&console.log("game changed:",d.game);A();t()});$("#players").change(function(){d.players=$(this).val();d.debug&&console.log("players changed:",
d.players);y();t()});$("body").find("input").each(function(a){if((a=$(this).attr("id"))&&a.startsWith("player")){var b=parseInt(a.substr(6));$(this).change(function(){d.player[b-1]=$(this).val().trim();d.player[b-1]!=$(this).val()&&$(this).val(d.player[b-1]);d.debug&&console.log("player "+b+" changed:",d.player[b-1]);t()})}});$("#clear").click(function(){for(var a=1;7>=a;a++)d.player[a-1]="",$("#player"+a).val("");t()});$("#next").click(function(){var a=window.location,b=d.game+".html#reset=1&language="+
d.language+"&players="+d.players;d.debug&&(b+="&debug=1");for(var c=[],e=1;e<=d.players;e++)c.push(d.player[e-1]||e);b+="&names="+c.map(encodeURI).join(",");a.href=b})}function x(){var a="[lang="+d.language+"]";$("body").find("[lang]").not(a).hide();$("body").find(a).show();$("body").find("select.langaware").each(function(a){var b=$(this);a=b.val();var f=b.data(d.language);b.empty();$.each(f,function(a,f){b.append($("<option>").attr("value",f[0]).html(f[1]))});a&&b.val(a)})}function A(){var a=r[d.game];
$("#players").children("option").each(function(b){b=$(this).attr("value");a.min<=b&&b<=a.max?$(this).show():$(this).hide()});var b=0;d.players<a.min?b=a.min:d.players>a.max&&(b=a.max);b&&(d.players=b,$("#players").val(d.players),y());a.min==a.max?$("#players").prop("disabled","disabled"):$("#players").prop("disabled",!1)}function y(){$("body").find("div").each(function(a){(a=$(this).attr("id"))&&a.startsWith("div")&&(parseInt(a.substr(3))<=d.players?$(this).show():$(this).hide())})}function B(){$("#language").val(d.language);
x();$("#game").val(d.game);A();$("#players").val(d.players);y();$.each(d.player,function(a,b){$("#player"+(a+1)).val(b)})}function z(){"undefined"!==typeof Storage&&(d.debug&&console.log("store",n),localStorage.setItem("bgss.game",JSON.stringify(n)))}function t(){if("undefined"!==typeof Storage){d.debug&&console.log("store",d);var a={};$.each(d.player,function(b,c){a[c]=1});d.names&&$.each(d.names,function(b,c){a[c]=1});delete a[""];d.names=Object.keys(a);d.names.sort();localStorage.setItem("bgss.main",
JSON.stringify(d))}}function C(){var a=d.debug;if("undefined"!==typeof Storage){var b=localStorage.getItem("bgss.main");if(b){d=JSON.parse(b);"undefined"!==typeof a&&(d.debug=a);d.debug&&console.log("fetch",d);d.names&&$.each(d.names,function(a,b){$("datalist#names").append($("<option>").text(b))});return}}d={language:"en",game:"164928",players:4,player:"      ".split(" ")};"undefined"!==typeof a&&(d.debug=a)}function D(){d={language:"en",players:4,player:"1234567".split("")};var a=window.location.hash;
a.length&&$.each(a.substr(1).split("&"),function(a,b){var c=b.split("=");if(2===c.length&&"language"==c[0])d[c[0]]=c[1];else if(2!==c.length||"debug"!=c[0]&&"players"!=c[0]&&"reset"!=c[0])if(2===c.length&&"names"==c[0])d.player=c[1].split(",").map(decodeURI);else throw"unexpected query: "+b;else d[c[0]]=parseInt(c[1])});window.location.hash=a.replace("reset=1&","");if(a=window.location.pathname.match(/(\d+)\.html$/))if(p=r[a[1]])d.game=a[1],$("#title").html(p[d.language]),document.title="BGSS - "+
$("#title").text();else throw"unexpected game: "+a[1];else throw"unexpected pathname: "+window.location.pathname;d.debug&&console.log("url2state",d)}var n={},h=[],r={},d={},p;return{define:function(a,b){r[a]=b},init_main:function(){var a=window.location.hash;a.length&&(a=a.match(/debug=(\d)/))&&(d.debug=parseInt(a[1]));k("en");k("fr");w();e();C();B()},init_game:function(){D();if("undefined"!==typeof Storage)if(d.reset)localStorage.removeItem("bgss.game");else{var a=localStorage.getItem("bgss.game");
a&&(n=JSON.parse(a),d.debug&&console.log("fetch",n))}p.init&&p.init(d);for(var a=$("#results table tbody"),b=1;b<=d.players;b++){var c=$("<tr>");c.append($("<td>").html(d.player[b-1]));c.append($("<td>").attr("id","result-"+b).text("0"));a.append(c)}l();v();w();p.setup&&p.setup(d);x();$("#tabs").children("li").first().click()},update_majority:function(a,b){for(var c={},e=1;e<=d.players;e++)c[h[e][a]]||(c[h[e][a]]=[]),c[h[e][a]].push(e);e=Object.keys(c);e.sort(function(a,b){return parseInt(a)>parseInt(b)?
-1:parseInt(a)<parseInt(b)?1:0});var f=0,g;$.each(e,function(d,e){var k=c[e],l=0;for(g=0;g<k.length;g++)l+=b[f++];l=Math.floor(l/k.length);for(g=0;g<k.length;g++)h[k[g]][a+"_bonus"]=l})},update_sum:function(a,b){b=b||0;for(var c=1;c<=d.players;c++)b+=h[c][a];if(a in h[0].sum&&h[0].sum[a]==b)return 0;h[0].sum[a]=b;return 1}}}();bgss.define("50",function(){return{en:"Lost Cities",fr:"Les Cit&eacute;s Perdues",min:2,max:2,score:function(g,a){a.score=0;for(var b=1;5>=b;b++){var c;c=0;a["exp"+b+"-c1"]&&c++;a["exp"+b+"-c2"]&&c++;a["exp"+b+"-c3"]&&c++;for(var k=c,m=0,l=2;10>=l;l++)a["exp"+b+"-"+l]&&(k++,m+=l);k?(m=(m-20)*(c+1),8<=k&&(m+=20),c=m):c=0;a["score"+b]=c;$("#score"+b+"-"+a.id).text(c);a.score+=c}}}}());bgss.define("124361",function(){return{en:"Concordia",fr:"Concordia",min:2,max:5,score:function(g,a){a.score=0;a.score+=Math.floor(a.money/10);a.score+=a.jupiter*a.houses;a.score+=a.saturnus*a.provinces;a.score+=a.mercurius*a.types;a.score+=a.mars*a.colonists;a.score+=3*a.brick;a.score+=3*a.food;a.score+=3*a.tool;a.score+=4*a.wine;a.score+=5*a.cloth;a.first&&(a.score+=7)}}}());bgss.define("164928",function(){return{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5,score:function(g,a){a.score=0;a.score+=a.coins;a.score+=a.grain;a.score+=2*a.cheese;a.score+=3*a.wine;a.score+=4*a.wool;a.score+=5*a.brocade;a.score+=(a.citizens+a.stations)*a.development;a.score+=a.extra}}}());bgss.define("193738",function(){return{en:"Great Western Trail",fr:"Great Western",min:2,max:4,score:function(g,a){a.score=0;a.score+=Math.floor(a.money/5);a.score+=a.buildings;a.score+=a.cities;a.score+=a.stations;a.score+=a.hazard;a.score+=a.cattle;a.score+=a.objective;a.score+=a.master;a.score+=4*a.workers;a.disc&&(a.score+=3);a.job&&(a.score+=2)}}}());bgss.define("185343",function(){return{en:"Anachrony",fr:"Anachrony",min:1,max:4,score:function(g,a){a.score=0;a.score+=a.buildings;a.score+=a.projects;a.score-=3*a.anomalies;a.score+=a.travel;a.score+=a.morale;a.score+=a.breakthroughs1;a.score+=a.breakthroughs2;a.score+=a.breakthroughs3;a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3);a.score+=a.tokens;a.score-=2*a.warps;a.endgame1&&(a.score+=3);a.endgame2&&(a.score+=3);a.endgame3&&(a.score+=3);a.endgame4&&(a.score+=3);a.endgame5&&
(a.score+=3)}}}());bgss.define("68448",function(){function g(a,b,c){return a*a+b*b+c*c+7*Math.min(a,b,c)}return{en:"7 Wonders",fr:"7 Wonders",min:2,max:7,score:function(a,b){var c;if(0===b.wild)c=g(b.tablets,b.compasses,b.gears);else if(1===b.wild)c=Math.max(g(b.tablets+1,b.compasses,b.gears),g(b.tablets,b.compasses+1,b.gears),g(b.tablets,b.compasses,b.gears+1));else if(2===b.wild)c=Math.max(g(b.tablets+2,b.compasses,b.gears),g(b.tablets,b.compasses+2,b.gears),g(b.tablets,b.compasses,b.gears+2),g(b.tablets+1,b.compasses+
1,b.gears),g(b.tablets+1,b.compasses,b.gears+1),g(b.tablets,b.compasses+1,b.gears+1));else throw"unexpected wild: "+b.wild;b.scientific=c;$("#scientific-"+b.id).text(b.scientific);b.score=0;b.score+=Math.floor(b.coins/3);b.score+=b.military;b.score+=b.wonder;b.score+=b.civilian;b.score+=b.commercial;b.score+=b.guild;b.score+=b.scientific;b.score+=b.extra}}}());bgss.define("216132",function(){var g,a;return{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4,init:function(b){3<=b.players?(g=[12,6,0,0],a=[18,12,6,0]):(g=[8,0],a=[12,0])},common:function(b){var c;c=0+bgss.update_sum("cotton",.1);c+=bgss.update_sum("tobacco",.2);if(c+=bgss.update_sum("sugar",.3)){var k=["cotton","tobacco","sugar"];k.sort(function(a,c){return b.sum[a]>b.sum[c]?1:b.sum[a]<b.sum[c]?-1:0});b[k[0]]=5;b[k[1]]=4;b[k[2]]=3;$("#vp_cotton").text(b.cotton);$("#vp_tobacco").text(b.tobacco);
$("#vp_sugar").text(b.sugar)}c+=bgss.update_sum("contracts");c+=bgss.update_sum("settlements");bgss.update_majority("contracts",g);bgss.update_majority("settlements",a);return c},score:function(a,c){c.score=0;c.score+=c.glory;c.score+=c.basic;c.score+=2*c.processed;c.score+=Math.floor(c.money/10);c.score+=c.money%10/10;c.score+=c.hops;c.score+=c.cotton*a.cotton;c.score+=c.tobacco*a.tobacco;c.score+=c.sugar*a.sugar;c.score+=c.contracts_bonus;c.score+=c.settlements_bonus}}}());bgss.define("31260",function(){function g(a,b){a>=b.length&&(a=b.length-1);return b[a]}var a=[-1,-1,1,2,3,4],b=[-1,1,2,3,4],c=[-1,1,1,1,2,2,3,3,4],k=[-1,1,2,3,4],m=[-1,1,1,1,2,2,3,3,4],l=[-1,1,1,2,2,3,3,4],v=[-1,1,2,2,3,3,4];return{en:"Agricola",fr:"Agricola",min:1,max:5,score:function(w,e){e.score=0;e.score+=g(e.plowed,a);e.score+=g(e.pastures,b);e.score+=g(e.grain,c);e.score+=g(e.vegetables,k);e.score+=g(e.sheep,m);e.score+=g(e.boar,l);e.score+=g(e.cattle,v);e.score-=e.unused;e.score+=e.stables;
e.score+=e.clay;e.score+=2*e.stone;e.score+=3*e.family;e.score+=e.card;e.score+=e.bonus;e.score-=3*e.begging}}}());bgss.define("215471",function(){var g=7,a=[-3,1,3,4,7,8,10,11];return{en:"Wind the Film!",fr:"Wind the Film!",min:2,max:4,init:function(a){g=2==a.players?5:3==a.players?6:7},setup:function(a){7>g&&$(".color7").hide();6>g&&$(".color6").hide()},score:function(b,c){c.score=0;for(var k=1;k<=g;k++)if(k==c.regret)$("#player1 .color"+k).hide();else{$("#player1 .color"+k).show();c["c"+k+"-g"]&&(c.score+=5);var m=c.score,l=c["c"+k+"-s"];l>=a.length&&(l=a.length-1);c.score=m+a[l];c.score-=2*c["c"+k+"-b"]}}}}());bgss.define("169786",function(){return{en:"Scythe",fr:"Scythe",min:1,max:5,score:function(g,a){a.score=0;a.score+=a.coins;6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):12>=a.popularity?(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*Math.floor(a.resources/2)):(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2));a.score+=a.bonus}}}());
