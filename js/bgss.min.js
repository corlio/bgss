var bgss=(function(){var g=[];var w=false;var e={"31260":{en:"Agricola",fr:"Agricola",min:1,max:5},"185343":{en:"Anachrony",fr:"Anachrony",min:1,max:4},"216132":{en:"Clans of Caledonia",fr:"Clans of Caledonia",min:1,max:4},"124361":{en:"Concordia",fr:"Concordia",min:2,max:5},"193738":{en:"Great Western Trail",fr:"Great Western",min:2,max:4},"164928":{en:"Orl&eacute;ans",fr:"Orl&eacute;ans",min:2,max:5}};var q={};var n={};function j(H,I){var G={};for(var K=1;K<=q.players;K++){if(!G[g[K][H]]){G[g[K][H]]=[]}G[g[K][H]].push(K)}var F=Object.keys(G);F.sort(function(M,L){if(parseInt(M)>parseInt(L)){return(-1)}if(parseInt(M)<parseInt(L)){return(+1)}return(0)});var J=0;$.each(F,function(L,N){var M=G[N];var P=0;var O;for(O=0;O<M.length;O++){P+=I[J++]}P=Math.floor(P/M.length);for(O=0;O<M.length;O++){g[M[O]][H+"_bonus"]=P}})}function i(F,G){G=G||0;for(var H=1;H<=q.players;H++){G+=g[H][F]}if(F in n&&n[F]==G){return(0)}n[F]=G;return(1)}function h(G){if(G.attr("type")=="checkbox"){return(G.prop("checked"))}var H=G.val();if(!H){return(0)}var F=parseInt(H);if(F.toString()!=H){G.val(F)}return(F)}function b(G){var F=[];$.each(e,function(I,H){if(!H[G]){return}F.push([I,H[G]])});F.sort(function(I,H){if(I[1]>H[1]){return(+1)}if(I[1]<H[1]){return(-1)}return(0)});$("#game").data(G,F)}function B(G,I){var H=G.clone().attr("id","player"+I);var F;H.find("*").each(function(J){F=$(this).attr("id");if(F){$(this).attr("id",F+"-"+I)}F=$(this).attr("for");if(F){$(this).attr("for",F+"-"+I)}F=$(this).attr("data-index");if(F){$(this).attr("data-index",I+F)}});return(H)}function r(I){var J;for(J=0;J<=q.players;J++){g.push({})}var G=$("#tabs").children("li").last();for(J=q.players;J>=1;J--){var F=$("<a>").attr("href","#player"+J).text(J);var H=$("<li>").addClass("tabs-title").append(F);G.before(H);G=H}G=$("#_player_");for(J=1;J<=q.players;J++){$("#tabs-content").append(B(G,J))}G.remove();$("#tabs").on("change.zf.tabs",function(){var M=$("#tabs-content").find(".tabs-panel.is-active").attr("id");var K=e[q.game][q.language];if(M&&M.startsWith("player")){var L=parseInt(M.substr(6));$("#title").html(K+" - "+q.player[L-1])}else{$("#title").html(K)}});$("#tabs-content").find("input,select").each(function(L){var N=$(this).attr("id");if(N){var K=N.substr(0,N.length-2);var M=parseInt(N.substr(-1));g[M][K]=h($(this));if(K=="score"){return}$(this).change(function(){g[M][K]=h($(this));I(M)})}});for(J=1;J<=q.players;J++){I(J)}Foundation.reInit($("#tabs"))}function E(){var F=$("#results table tbody");for(var H=1;H<=q.players;H++){var G=$("<tr>");G.append($("<td>").html(q.player[H-1]));G.append($("<td>").attr("id","result-"+H).text("0"));F.append(G)}}function o(){$("form").on("keydown","input",function(I){if(I.which==13){I.preventDefault();var F=$(I.target);var G=F.attr("data-index");if(G){var H=parseInt(G)+1;$("[data-index="+H+"]").focus()}}})}function p(){var F="[lang="+q.language+"]";$("body").find("[lang]").not(F).hide();$("body").find(F).show();$("#container").find("select.langaware").each(function(I){var G=$(this);var J=G.val();var H=G.data(q.language);G.empty();$.each(H,function(L,K){G.append($("<option>").attr("value",K[0]).html(K[1]))});if(J){G.val(J)}})}function d(){var F=e[q.game];$("#players").children("option").each(function(G){var H=$(this).attr("value");if(F.min<=H&&H<=F.max){$(this).show()}else{$(this).hide()}})}function c(){$("#container").children("div").each(function(F){var H=$(this).attr("id");if(H&&H.startsWith("player")){var G=parseInt(H.substr(6));if(G<=q.players){$(this).show()}else{$(this).hide()}}})}function t(F){}function A(){$("#tabs").children("li").first().click()}function s(){$("#language").val(q.language);p();$("#game").val(q.game);d();$("#players").val(q.players);c();$.each(q.player,function(G,F){var H=G+1;$("input#player"+H).val(F);t(H)})}function x(){if(typeof(Storage)!=="undefined"){if(w){console.log("store",q)}localStorage.setItem("bgss",JSON.stringify(q))}}function l(){if(typeof(Storage)!=="undefined"){var F=localStorage.getItem("bgss");if(F){q=JSON.parse(F);if(w){console.log("fetch",q)}return}}q={language:"en",game:"164928",players:4,player:["","","","","","",""]}}function v(){q={language:"en",players:4,player:["1","2","3","4","5","6","7"]};var H=window.location.hash;if(H.length){$.each(H.substr(1).split("&"),function(I,K){var J=K.split("=");if(J.length===2&&(J[0]=="language"||J[0]=="players")){q[J[0]]=J[1]}else{if(J.length===2&&J[0]=="names"){q.player=J[1].split(",").map(decodeURI)}else{throw ("unexpected query: "+K)}}})}var G=window.location.pathname.match(/(\d+)\.html$/);if(G){var F=e[G[1]];if(F){q.game=G[1];$("#title").html(F[q.language]);document.title="BGSS - "+$("#title").text()}else{throw ("unexpected game: "+G[1])}}else{throw ("unexpected pathname: "+window.location.pathname)}if(w){console.log("search",q)}}function D(F,I){var G=g[I];if(!G[F]){return}for(var H=1;H<=q.players;H++){if(H!=I&&g[H][F]){$("#"+F+"-"+H).click()}}}function k(G,F){if(G>=F.length){G=F.length-1}return(F[G])}function f(G){var F=g[G];F.score=0;F.score+=k(F.plowed,[-1,-1,1,2,3,4]);F.score+=k(F.pastures,[-1,1,2,3,4]);F.score+=k(F.grain,[-1,1,1,1,2,2,3,3,4]);F.score+=k(F.vegetables,[-1,1,2,3,4]);F.score+=k(F.sheep,[-1,1,1,1,2,2,3,3,4]);F.score+=k(F.boar,[-1,1,1,2,2,3,3,4]);F.score+=k(F.cattle,[-1,1,2,2,3,3,4]);F.score-=F.unused;F.score+=F.stables;F.score+=F.clay;F.score+=F.stone*2;F.score+=F.family*3;F.score+=F.card;F.score+=F.bonus;F.score-=F.begging*3;if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}function z(G){var F=g[G];F.score=0;F.score+=F.buildings;F.score+=F.projects;F.score-=F.anomalies*3;F.score+=F.travel;F.score+=F.morale;F.score+=F.breakthroughs1;F.score+=F.breakthroughs2;F.score+=F.breakthroughs3;F.score+=Math.min(F.breakthroughs1,F.breakthroughs2,F.breakthroughs3)*2;F.score+=F.tokens;F.score-=F.warps*2;if(F.endgame1){F.score+=3}if(F.endgame2){F.score+=3}if(F.endgame3){F.score+=3}if(F.endgame4){F.score+=3}if(F.endgame5){F.score+=3}if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}function y(I){var H=0;H+=i("cotton",0.1);H+=i("tobacco",0.2);H+=i("sugar",0.3);if(H){var G=["cotton","tobacco","sugar"];G.sort(function(K,J){if(n[K]>n[J]){return(+1)}if(n[K]<n[J]){return(-1)}return(0)});g[0][G[0]]=5;g[0][G[1]]=4;g[0][G[2]]=3;$("#vp_cotton").text(g[0].cotton);$("#vp_tobacco").text(g[0].tobacco);$("#vp_sugar").text(g[0].sugar)}H+=i("contracts");H+=i("settlements");if(q.players>=3){j("contracts",[12,6,0,0]);j("settlements",[18,12,6,0])}else{j("contracts",[8,0]);j("contracts",[12,0])}if(H||!I){if(w){console.log("general",g[0])}for(var F=1;F<=q.players;F++){m(F)}}else{m(I)}}function m(G){var F=g[G];F.score=0;F.score+=F.glory;F.score+=F.basic;F.score+=F.processed*2;F.score+=Math.floor(F.money/10);F.score+=(F.money%10)/10;F.score+=F.hops;F.score+=F.cotton*g[0].cotton;F.score+=F.tobacco*g[0].tobacco;F.score+=F.sugar*g[0].sugar;F.score+=F.contracts_bonus;F.score+=F.settlements_bonus;if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}function u(G){var F=g[G];D("first",G);F.score=0;F.score+=Math.floor(F.money/10);F.score+=F.jupiter*F.houses;F.score+=F.saturnus*F.provinces;F.score+=F.mercurius*F.types;F.score+=F.mars*F.colonists;F.score+=F.brick*3;F.score+=F.food*3;F.score+=F.tool*3;F.score+=F.wine*4;F.score+=F.cloth*5;if(F.first){F.score+=7}if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}function C(G){var F=g[G];D("job",G);F.score=0;F.score+=Math.floor(F.money/5);F.score+=F.buildings;F.score+=F.cities;F.score+=F.stations;F.score+=F.hazard;F.score+=F.cattle;F.score+=F.objective;F.score+=F.master;F.score+=F.workers*4;if(F.disc){F.score+=3}if(F.job){F.score+=2}if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}function a(G){var F=g[G];F.score=0;F.score+=F.coins;F.score+=F.grain;F.score+=F.cheese*2;F.score+=F.wine*3;F.score+=F.wool*4;F.score+=F.brocade*5;F.score+=(F.citizens+F.stations)*F.development;if(w){console.log("player "+G+" score:",F.score,F)}$("#score-"+G).val(F.score);$("#result-"+G).text(F.score)}return({init_main:function(){b("en");b("fr");o();$("#language").change(function(){q.language=$(this).val();if(w){console.log("language changed:",q.language)}p();x()});$("#game").change(function(){q.game=$(this).val();if(w){console.log("game changed:",q.game)}d();x()});$("#players").change(function(){q.players=$(this).val();if(w){console.log("players changed:",q.players)}c();x()});$("#container").find("input").each(function(F){var H=$(this).attr("id");if(H&&H.startsWith("player")){var G=parseInt(H.substr(6));$(this).change(function(){q.player[G-1]=$(this).val().trim();if(w){console.log("player "+G+" changed:",q.player[G-1])}t(G);x()})}});$("#clear").click(function(){for(var F=1;F<=7;F++){q.player[F-1]="";$("input#player"+F).val("");t(F)}x()});$("#next").click(function(){var G=[];for(var H=1;H<=q.players;H++){G.push(q.player[H-1]||H)}var F=q.game+".html#language="+q.language+"&players="+q.players+"&names="+G.map(encodeURI).join(",");window.location.href=F});l();s()},init_31260:function(){v();E();r(f);o();p();A()},init_124361:function(){v();E();r(u);o();p();A()},init_164928:function(){v();E();r(a);o();p();A()},init_185343:function(){v();E();r(z);o();p();A()},init_193738:function(){v();E();r(C);o();p();A()},init_216132:function(){v();E();r(y);o();p();A();y(0)}})})();