(function(C){"function"===typeof define&&define.amd?define(C):C()})(function(){function C(a,...b){if(!M[a]){for(var c=a,d,f=[];c;){if(null!==(d=oa.exec(c)))f.push(d[0]);else if(null!==(d=pa.exec(c)))f.push("%");else if(null!==(d=qa.exec(c)))null!=d[4]&&(d[4]=parseInt(d[4],10)),null!=d[5]&&(d[5]=parseInt(d[5],10)),f.push(d);else throw"sprintf: unexpected format: "+c;c=c.substring(d[0].length)}M[a]=f}d=M[a];a=0;c=[];let g;for(let h of d)if(h instanceof Array){d=b[a++];if(ra.test(h[6])&&"number"!==typeof d)throw"sprintf: expecting number but got "+
typeof d;switch(h[6]){case "b":d=d.toString(2);break;case "c":d=String.fromCharCode(d);break;case "d":d=parseInt(d,10);break;case "e":d=h[5]?d.toExponential(h[5]):d.toExponential();break;case "f":d=h[5]?parseFloat(d).toFixed(h[5]):parseFloat(d);break;case "o":d=d.toString(8);break;case "s":d=String(d);d=h[5]?d.substring(0,h[5]):d;break;case "x":d=d.toString(16);break;case "X":d=d.toString(16).toUpperCase()}d=sa.test(h[6])&&h[1]&&0<=d?"+"+d:d;f=h[2]?"0"===h[2]?"0":h[2].charAt(1):" ";g=h[4]-String(d).length;
f=h[4]?0<g?Array(g+1).join(f):"":"";c.push(h[3]?d+f:f+d)}else c.push(h);return c.join("")}function N(a){return O[a]||O.all}function Z(a){{let b=typeof a;a="object"!==b?b:Object.prototype.toString.call(a).slice(8,-1)}return"string"===a||"String"===a}function w(...a){throw C.call(null,...a);}function aa(a){t[a]||(t[a]=document.getElementById(a),t[a]||w("element not found: #%s",a));return t[a]}function m(a){return Z(a)?aa(a):a}function P(a,b){a=window.getComputedStyle(m(a),null);return null==b?a:a[b]}
function Q(a,b){a=m(a);if(null==b)return a.disabled;a.disabled=b?!0:!1}function R(a,b){a=m(a);if(null==b)return a.hidden;a.hidden=b?!0:!1}function ba(a){if(a.nodeType!==window.Node.TEXT_NODE){var b=a.getAttribute("id");b in t&&delete t[b];a.querySelectorAll("[id]").forEach(function(c){b=c.getAttribute("id");b in t&&delete t[b]})}}function x(){if(null==F){F=!1;try{let a=Object.defineProperty({},"passive",{get:function(){F={passive:!0};return!0}});window.addEventListener("testPassive",null,a);window.removeEventListener("testPassive",
null,a)}catch(a){}}return F}function ca(a,...b){S.push([a,...b]);da()}function da(){if(ea)for(;S.length;){let [a,...b]=S.shift();if(D[a]){u.log("message","dispatch",a,b);for(let c of D[a])c[0].apply(c[1],c.slice(2).concat(b))}}}function G(a,...b){if(!T[a]){for(var c=a,d,f=[];c;){if(null!==(d=ta.exec(c)))f.push(d[0]);else if(null!==(d=ua.exec(c)))f.push("%");else if(null!==(d=va.exec(c)))null!=d[4]&&(d[4]=parseInt(d[4],10)),null!=d[5]&&(d[5]=parseInt(d[5],10)),f.push(d);else throw"sprintf: unexpected format: "+
c;c=c.substring(d[0].length)}T[a]=f}d=T[a];a=0;c=[];let g;for(let h of d)if(h instanceof Array){d=b[a++];if(wa.test(h[6])&&"number"!==typeof d)throw"sprintf: expecting number but got "+typeof d;switch(h[6]){case "b":d=d.toString(2);break;case "c":d=String.fromCharCode(d);break;case "d":d=parseInt(d,10);break;case "e":d=h[5]?d.toExponential(h[5]):d.toExponential();break;case "f":d=h[5]?parseFloat(d).toFixed(h[5]):parseFloat(d);break;case "o":d=d.toString(8);break;case "s":d=String(d);d=h[5]?d.substring(0,
h[5]):d;break;case "x":d=d.toString(16);break;case "X":d=d.toString(16).toUpperCase()}d=xa.test(h[6])&&h[1]&&0<=d?"+"+d:d;f=h[2]?"0"===h[2]?"0":h[2].charAt(1):" ";g=h[4]-String(d).length;f=h[4]?0<g?Array(g+1).join(f):"":"";c.push(h[3]?d+f:f+d)}else c.push(h);return c.join("")}function ya(a){a||(a=new Date);return G("%d/%02d/%02d-%02d:%02d:%02d",a.getFullYear(),a.getMonth()+1,a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())}function fa(a){a=e.attr(a,"data-index");if(!a)return null;a=G("%s%03d%s",
ha,parseInt(a,10)+1,ha);return document.querySelector("[data-index="+a+"]")}function v(a,b){a>=b.length&&(a=b.length-1);return b[a]}function H(a,b,c,d){if(0===d)return a*a+b*b+c*c+7*Math.min(a,b,c);d--;return Math.max(H(a+1,b,c,d),H(a,b+1,c,d),H(a,b,c+1,d))}function za(a,b){a=Number(a);b=Number(b);return a>b?1:a<b?-1:0}function Aa(a,b){a=String(a);b=String(b);return a>b?1:a<b?-1:0}function Ba(a,b){return String(a).toLowerCase().localeCompare(String(b).toLowerCase())}function U(a,b,c,d){null!=c?d?
a.sort((f,g)=>b(g[c],f[c])):a.sort((f,g)=>b(f[c],g[c])):d?a.sort((f,g)=>b(g,f)):a.sort((f,g)=>b(f,g))}function I(a,b,c){let d={};for(var f=1;f<=a.players;f++)d[a.data[f][b]]||(d[a.data[f][b]]=[]),d[a.data[f][b]].push(f);var g=Object.keys(d).map(h=>parseInt(h,10));V.num(g,{reverse:!0});f=0;for(const h of g){g=d[h];let p=0;for(const q of g)p+=c[f++];p=Math.floor(p/g.length);for(const q of g)a.data[q][b+"_vp"]=p}}function Ca(a,b,c,d){for(var f=1;f<=a.players;f++)a.data[f]["t"+b+"p"]=0;f={};for(var g=
1;g<=a.players;g++)f[d[g]]||(f[d[g]]=[]),f[d[g]].push(g);g=Object.keys(f).map(h=>parseInt(h,10));if(2!==a.players||1!==g.length){V.num(g,{reverse:!0});d=2===a.players?3:2;for(const h of g){if(0===h)break;g=f[h];let p=0;for(const q of g)p+=c,c=Math.floor(c/d);p=Math.floor(p/g.length);if(0!==p)for(const q of g)a.data[q]["t"+b+"p"]=p}}}function Da(a,b,c){0===a&&"fireland"===b&&e.all(".fireland",d=>e.hidden(d,!c))}function Ea(a){let b=parseInt(a.target.value,10);a=a.target.parentNode.parentNode.parentNode;
for(let c=1;9>=c;c++){let d=c>b?e.hide:e.show;a.querySelectorAll(".card"+c).forEach(d)}}function Fa(a){var b={};2===a.players&&(b[3]=!0);for(var c=1;c<=a.players;c++)b[a.data[c].influence]=!0;b=Object.keys(b).map(f=>parseInt(f,10));V.num(b,{reverse:!0});let d={};0<b.length&&(c=b.shift(),d[c]=4);0<b.length&&(c=b.shift(),d[c]=2);0<b.length&&b.forEach(f=>d[f]=1);a.data[0].ivp=d}function Ga(a){let b,c,d;for(b=a.length-1;0<b;b--)c=Math.floor(Math.random()*(b+1)),d=a[b],a[b]=a[c],a[c]=d}function r(a){a=
e.attr(a,"id");if(!a||!/^\w+\d$/.test(a))return null;let b=a.substring(0,a.length-1),c=parseInt(a.charAt(a.length-1),10);return{string:a,name:b,number:c}}function Ha(){n.language2ui(l.language);e.all("#tab-links li",function(a){let b=r(a);b&&"tabl"===b.name&&(b.number<=l.players||e.hide(a))});e.all("#tabcx table tbody tr",function(a){let b=r(a);b&&"srow"===b.name&&(b.number<=l.players||e.hide(a))});for(let a=1;a<=l.players;a++)l.names[a-1]&&(e.text("iname"+a,l.names[a-1]),e.text("sname"+a,l.names[a-
1]));e.text("date",ya());e.all("input",function(a){let b=r(a);if(b&&l.data[b.number]&&"undefined"!==typeof l.data[b.number][b.name]){var c=e.attr(a,"type");"number"===c?a.value=l.data[b.number][b.name]:"checkbox"===c&&(a.checked=l.data[b.number][b.name])}});e.all("select",function(a){let b=r(a);b&&l.data[b.number]&&"undefined"!==typeof l.data[b.number][b.name]&&(a.value=l.data[b.number][b.name])});e.all("input[type=checkbox].highlander:checked",function(a){ia(a)})}function Ia(a){let b={};e.all("#tabc"+
a+" input",function(c){let d=r(c);if(d&&!(e.class.test(c,"hidden")||e.class.test(c.parentNode,"hidden")||e.class.test(c.parentNode.parentNode,"hidden"))){var f=e.attr(c,"type");"number"===f?(c=e.attr(c,"min"),b[d.name]=c?parseInt(c,10):0):"checkbox"===f&&(b[d.name]=!1)}});e.all("#tabc"+a+" select",function(c){(c=r(c))&&(b[c.name]=0)});return b}function ia(a){let b=r(a),c=a.checked;e.all("input[type=checkbox][id^="+b.name+"].highlander",function(d){let f=r(d);b.string===f.string||b.name!==f.name||
f.number>l.players||(l.data[f.number][f.name]=!1,d.checked=!1,d.disabled=c)})}function Ja(a){a=a.target;let b=r(a);if(b){var c=e.attr(a,"type");if("number"===c){c=parseInt(a.value,10);c!==c&&a.value.startsWith(".")&&(c=-parseInt(a.value.substring(1),10),a.value=c);var d=e.attr(a,"min");null!=d&&(d=parseInt(d,10),c<d&&(c=d,a.value=c));d=e.attr(a,"max");null!=d&&(d=parseInt(d,10),c>d&&(c=d,a.value=c));l.data[b.number][b.name]=c}else"checkbox"===c&&(e.class.test(a,"highlander")&&ia(a),l.data[b.number][b.name]=
a.checked);J.send("change",b.number,b.name,l.data[b.number][b.name]);n.state2storage(n.GAME_STORAGE,l)}}function Ka(a){a=a.target;let b=r(a);b&&(l.data[b.number][b.name]=parseInt(a.value,10),J.send("change",b.number,b.name,l.data[b.number][b.name]),n.state2storage(n.GAME_STORAGE,l))}function La(){let a={};for(let b=0;b<=l.players;b++)y[l.game].score(l,b),0!==b&&(a[l.data[b].score]=1);u.log("state",l);e.all(".score",function(b){let c=r(b),d;!c||c.number>l.players||(d=c.name.includes("score")?"score":
c.name,e.text(b,l.data[c.number][d]))});e.hidden("tie",Object.keys(a).length===l.players)}function Ma(a,b){b<l.players?(b++,e.get("tabl"+b).querySelector("button").click(),e.get("iname"+b).scrollIntoView(!0)):(e.get("tablx").querySelector("button").click(),window.scrollTo(0,0))}function Na(){e.on("home","click",()=>window.history.back());e.all("input",function(a){e.on(a,"change",Ja);e.on(a,"keydown",n.enter2tab);e.on(a,"focus",n.focus2select)});e.all("select",function(a){e.on(a,"change",Ka)});e.on("tablx",
"show.bs.tab",La);e.all("a.nextab",function(a){let b=parseInt(e.id(a).substring(6));e.on(a,"click",Ma,b)})}function ja(a){return a.split(/([^A-z\u00c0-\u00fa]+)/).map(b=>b.charAt(0).toUpperCase()+b.slice(1)).join("")}function Oa(a){k.known=k.known.filter(b=>b!==a)}function ka(){let a=!1,b=y[k.game].players.min,c=y[k.game].players.max;k.players<b?(k.players=b,a=!0):k.players>c&&(k.players=c,a=!0);e.all("select#players option",function(f){let g=parseInt(e.attr(f,"value"),10);e.hidden(f,g<b||g>c)});
let d=e.get("players");e.disabled(d,b===c);a&&(d.value=k.players,W())}function W(){for(let a=1;7>=a;a++){let b=e.get("player"+a).parentNode.parentNode;e.hidden(b,a>k.players)}}function Pa(a){k.language=a.target.value;n.language2ui(k.language);n.state2storage(n.HOME_STORAGE,k)}function Qa(a,b){k.game=a.target.value;for(const c of K)c!==b&&(e.get("game-"+c).value=k.game);ka();n.state2storage(n.HOME_STORAGE,k)}function Ra(a){k.players=parseInt(a.target.value,10);W();n.state2storage(n.HOME_STORAGE,k)}
function Sa(a,b){let c=ja(a.target.value.trim());a.target.value=c;k.names[b-1]=c;n.state2storage(n.HOME_STORAGE,k)}function Ta(){for(let a=1;7>=a;a++)e.get("player"+a).value=""}function Ua(){var a={};for(var b of k.known)a[b]=1;for(b=1;b<=k.players;b++)k.names[b-1]&&(a[k.names[b-1]]=1);delete a[""];k.known=Object.keys(a);k.known.sort();n.state2storage(n.HOME_STORAGE,k);"undefined"!==typeof Storage&&localStorage.removeItem(n.GAME_STORAGE);a=window.location;b=k.game+".html?language="+k.language;b+=
"&players="+k.players;k.debug&&(b+="&debug=1");let c=[];for(let d=1;d<=k.players;d++)c.push(k.names[d-1]||"");b+="&names="+c.map(encodeURI).join(",");a.href=b}const sa=/[def]/,qa=/^\x25(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosxX])/,ra=/[^s]/,pa=/^\x25{2}/,oa=/^[^\x25]+/;let M={},O={};const u={enabled:N,log:function(a,...b){N(a)&&console.debug.apply(null,["["+a+"]",...b])},logf:function(a,...b){N(a)&&console.debug("["+a+"]",C.apply(null,b))},setup:function(a){for(let b of a.split(/\W+/))O[b]=!0}};
let t={},F;const e={"class":{add:function(a,b,c){let d=m(a).classList;d.add(b);c&&setTimeout(()=>d.remove(b),c)},remove:function(a,b){m(a).classList.remove(b)},test:function(a,b){return m(a).classList.contains(b)},toggle:function(a,b){a=m(a).classList;a.contains(b)?a.remove(b):a.add(b)}},all:function(a,b){if(null==b)return document.querySelectorAll(a).length;document.querySelectorAll(a).forEach(b)},append:function(a,...b){a=m(a);for(let c of b)a.appendChild(m(c))},attr:function(a,b,c){a=m(a);if(null==
c)return a.getAttribute(b);a.setAttribute(b,c)},children:function(a,b){a=m(a).children;if(null==b)return a.length;for(let c=0;c<a.length;c++)b(a[c],c)},create:function(a,...b){a=document.createElement(a);for(let c of b)if(Z(c))a.classList.add(c);else if(c instanceof Array)for(b=0;b<c.length;b++)a.classList.add(c[b]);else for(let d in c)Object.prototype.hasOwnProperty.call(c,d)&&a.setAttribute(d,c[d]);return a},css:P,disable:function(a){Q(a,!0)},disabled:Q,empty:function(a){a=m(a);let b=0;for(;a.firstChild;)ba(a.firstChild),
a.removeChild(a.firstChild),b++;return b},enable:function(a){Q(a,!1)},first:function(a){return document.querySelector(a)},get:aa,height:function(a,b){a=m(a);if(null==b)return parseFloat(P(a,"height").replace("px",""));a.style.height=b+"px"},hidden:R,hide:function(a){R(a,!0)},id:function(a,b){a=m(a);if(null==b)return a.getAttribute("id");a.setAttribute("id",b)},index:function(a){a=m(a);let b=0;for(;a.previousSibling;)a=a.previousSibling,b++;return b},left:function(a,b){a=m(a);if(null==b)return a.offsetLeft;
a.style.left=b+"px"},on:function(a,b,c,...d){a=m(a);a.addEventListener(b,function(f){c.apply(null,[f,...d])})},pon:function(a,b,c,...d){a=m(a);a.addEventListener(b,function(f){c.apply(null,[f,...d])},x())},prepend:function(a,...b){a=m(a);for(let c of b)a.insertBefore(m(c),a.firstChild)},press:function(a,b,c,...d){let f,g,h,p,q,E,X;q=function(){E=null;c.apply(null,[h,!0,...d])};g=function(L){if("touchstart"===L.type)X=!0,f=!1;else if(X)return;h=L;E=setTimeout(q,b)};p=function(L){"touchend"!==L.type&&
X||!E||(clearTimeout(E),E=null,f||c.apply(null,[h,!1,...d]))};a=m(a);a.addEventListener("mousedown",g,x());a.addEventListener("touchstart",g,x());a.addEventListener("mouseup",p,x());a.addEventListener("touchend",p,x());a.addEventListener("touchmove",function(){f=!0},x())},remove:function(a){a=m(a);ba(a);a.parentNode&&a.parentNode.removeChild(a)},reparent:function(a,b){a=m(a);b=m(b);if(a.parentNode){if(a.parentNode.isSameNode(b))return!1;a.parentNode.removeChild(a)}b.appendChild(a);return!0},show:function(a){R(a,
!1)},swap:function(a,b){a=m(a);b=m(b);let c=a.parentNode,d=a.nextSibling===b?a:a.nextSibling;b.parentNode.insertBefore(a,b);c.insertBefore(b,d)},tag:function(a){a=m(a);return a.tagName.toLowerCase()},text:function(a,b){a=m(a);if(null==b)return a.textContent;a.textContent=b},top:function(a,b){a=m(a);if(null==b)return a.offsetTop;a.style.top=b+"px"},width:function(a,b){a=m(a);if(null==b)return parseFloat(P(a,"width").replace("px",""));a.style.width=b+"px"}};let ea=!1,S=[],D={},la={};const J={ready:function(){ea=
!0;da()},send:ca,subscribe:function(a,...b){0<b.length&&"function"===typeof b[0]?b.splice(1,0,null):1<b.length&&"function"===typeof b[1]?[b[0],b[1]]=[b[1],b[0]]:w("invalid subscription: %s",a);D[a]||(D[a]=[]);D[a].push(b);"window.resize"!==a||la[a]||(window.onresize=()=>ca(a),la[a]=!0);u.log("message","subscribe",a,b)}};let z,A;const B={get:function(a){return z[a]},parse:function(a){null==a&&(a=window.location.search);if(!(1>=a.length)){"?"===a[0]&&(a=a.substring(1));a=a.split("&");for(let b of a){a=
b.split("=");2!=a.length&&w("unexpected parameter: %s",b);let c=decodeURI(a[1]);a[0]in A||w("unexpected parameter: %s",b);let d=typeof A[a[0]];"boolean"===d?z[a[0]]="false"!==c&&c?!0:!1:"number"===d?z[a[0]]=Number(c):"string"===d?z[a[0]]=c:w("unexpected parameter type: %s",d)}}},setup:function(a){z={};A=a;for(let b in A)a=typeof A[b],"boolean"===a||"number"===a||"string"===a?z[b]=A[b]:w("unexpected parameter type: %s",a)}},xa=/[def]/,va=/^\x25(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosxX])/,wa=/[^s]/,
ua=/^\x25{2}/,ta=/^[^\x25]+/;let T={};const ha=String.fromCharCode(34);let Y=null;const n={GAME_STORAGE:"bgss.game",HOME_STORAGE:"bgss.home",enter2tab:function(a){if(13===a.which){var b=fa(a.target);b&&(a.preventDefault(),b.focus())}},focus2select:function(){let a=event.target;Y&&e.id(Y)===e.id(a)&&a.select();Y=fa(a)},language2ui:function(a){document.documentElement.lang=a;e.all("span[lang]",function(b){e.hidden(b,e.attr(b,"lang")!==a)});e.all("div[lang]",function(b){e.hidden(b,e.attr(b,"lang")!==
a)})},state2storage:function(a,b){"undefined"!==typeof Storage&&(b=Object.assign({},b),delete b.debug,localStorage.setItem(a,JSON.stringify(b)))},storage2state:function(a,b){if("undefined"!==typeof Storage&&(a=localStorage.getItem(a))){a=JSON.parse(a);for(const c in b)"undefined"!==typeof a[c]&&(b[c]=a[c])}}};var Va=Object.freeze({__proto__:null,score:function(a,b){if(0!==b){a=a.data[b];a.score=0;for(let f=1;5>=f;f++){b=a.score;var c=a,d=f;let g=0;c["e"+d+"c1"]&&g++;c["e"+d+"c2"]&&g++;c["e"+d+"c3"]&&
g++;let h=g,p=0;for(let q=2;10>=q;q++)c[G("e%d%02d",d,q)]&&(h++,p+=q);h&&(p=(p-20)*(g+1),8<=h&&(p+=20));c["e"+d+"s"]=p;a.score=b+p}}}}),Wa=[-1,-1,1,2,3,4],Xa=[-1,1,2,3,4],Ya=[-1,1,1,1,2,2,3,3,4],Za=[-1,1,2,3,4],$a=[-1,1,1,1,2,2,3,3,4],ab=[-1,1,1,2,2,3,3,4],bb=[-1,1,2,2,3,3,4],cb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=v(a.plowed,Wa),a.score+=v(a.pastures,Xa),a.score+=v(a.grain,Ya),a.score+=v(a.vegetables,Za),a.score+=v(a.sheep,$a),a.score+=v(a.boar,
ab),a.score+=v(a.cattle,bb),a.score-=a.unused,a.score+=a.stables,a.score+=a.clay,a.score+=2*a.stone,a.score+=3*a.family,a.score+=a.card,a.score+=a.bonus,a.score-=3*a.begging)}}),db=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.money,a.score+=a.building,a.score+=a.ship,a.score-=7*a.loans)}}),eb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.scientific=H(a.tablets,a.compasses,a.gears,a.wild),a.score=0,a.score+=Math.floor(a.coins/
3),a.score+=a.military,a.score+=a.wonder,a.score+=a.civilian,a.score+=a.commercial,a.score+=a.guild,a.score+=a.scientific,a.score+=a.extra)}}),fb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=Math.floor(a.money/10),a.score+=a.jupiter*a.houses,a.score+=a.saturnus*a.provinces,a.score+=a.mercurius*a.types,a.score+=a.mars*a.colonists,a.score+=3*a.brick,a.score+=3*a.food,a.score+=3*a.tool,a.score+=4*a.wine,a.score+=5*a.cloth,a.first&&(a.score+=7))}}),gb=Object.freeze({__proto__:null,
score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.coins,a.score+=a.grain,a.score+=2*a.cheese,a.score+=3*a.wine,a.score+=4*a.wool,a.score+=5*a.brocade,a.score+=(a.citizens+a.stations)*a.development,a.score+=a.extra)}}),hb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.coins,6>=a.popularity?(a.score+=3*a.stars,a.score+=2*a.territories,a.score+=1*Math.floor(a.resources/2)):12>=a.popularity?(a.score+=4*a.stars,a.score+=3*a.territories,a.score+=2*
Math.floor(a.resources/2)):(a.score+=5*a.stars,a.score+=4*a.territories,a.score+=3*Math.floor(a.resources/2)),a.score+=a.bonus,a.score-=a.malus)}});const ib=[0,1,4,9,16,25],jb=[0,3,6,10,15];var kb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.iki,a.score+=ib[a.character],a.score+=jb[a.fish1],a.score+=a.fish2,a.score+=a.tobacco*(a.pipe?2:1),a.score+=a.building,a.score+=3*a.koban,a.score+=a.wood,a.score+=Math.floor(a.money/4))}}),lb=Object.freeze({__proto__:null,
score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.buildings,a.score+=a.projects,a.score-=3*a.anomalies,a.score+=a.travel,a.score+=a.morale,a.score+=a.breakthroughs1,a.score+=a.breakthroughs2,a.score+=a.breakthroughs3,a.score+=2*Math.min(a.breakthroughs1,a.breakthroughs2,a.breakthroughs3),a.score+=a.tokens,a.score-=2*a.warps,a.endgame1&&(a.score+=3),a.endgame2&&(a.score+=3),a.endgame3&&(a.score+=3),a.endgame4&&(a.score+=3),a.endgame5&&(a.score+=3))}}),mb=Object.freeze({__proto__:null,init:function(a){if(!a.data[0]){var b=
[];for(let c=1;12>=c;c++)b.push(c+(.5>Math.random()?"a":"b"));a.data[0]={sides:b}}a=a.data[0];for(b=1;12>=b;b++)e.text(G("side%02d",b),a.sides[b-1])},score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=Math.floor(a.money/5),a.score+=a.buildings,a.score+=a.cities,a.score+=a.stations,a.score+=a.hazard,a.score+=a.cattle,a.score+=a.objective,a.score+=a.master,a.score+=4*a.workers,a.disc&&(a.score+=3),a.job&&(a.score+=2))}});const nb=[-3,1,3,4,7,8,10,11,11,11,11,11,11];var ob=Object.freeze({__proto__:null,
init:function(a){let b;b=2===a.players?5:3===a.players?6:7;7>b&&e.all(".color7",c=>e.hide(c));6>b&&e.all(".color6",c=>e.hide(c));a.data[0]={colors:b}},score:function(a,b){if(0!==b){var c=a.data[0];a=a.data[b];a.score=0;for(b=1;b<=c.colors;b++)a["s"+b]=0,b!==a.missed&&(a["c"+b+"g"]&&(a["s"+b]+=5),a["s"+b]+=nb[a["c"+b+"s"]],a["s"+b]-=2*a["c"+b+"b"],a.score+=a["s"+b])}}});const V={num:function(a,{property:b,reverse:c=!1}={}){U(a,za,b,c)},str:function(a,{property:b,reverse:c=!1}={}){U(a,Aa,b,c)},cis:function(a,
{property:b,reverse:c=!1}={}){U(a,Ba,b,c)}};var pb=Object.freeze({__proto__:null,score:function(a,b){let c=a.data[0];if(0===b){let d={cotton:.1,tobacco:.2,sugar:.3};for(b=1;b<=a.players;b++)d.cotton+=a.data[b].cotton,d.tobacco+=a.data[b].tobacco,d.sugar+=a.data[b].sugar;b=["cotton","tobacco","sugar"];b.sort(function(f,g){return d[f]>d[g]?1:d[f]<d[g]?-1:0});c[b[0]]=5;c[b[1]]=4;c[b[2]]=3;3<=a.players?(I(a,"contracts",[12,6,0,0]),I(a,"settlements",[18,12,6,0])):(I(a,"contracts",[8,0]),I(a,"settlements",
[12,0]))}else a=a.data[b],a.score=0,a.score+=a.glory,a.score+=a.basic,a.score+=2*a.processed,a.score+=Math.floor(a.money/10),a.score+=a.money%10/10,a.score+=a.hops,a.score+=a.cotton*c.cotton,a.score+=a.tobacco*c.tobacco,a.score+=a.sugar*c.sugar,a.score+=a.contracts_vp,a.score+=a.settlements_vp}}),qb=Object.freeze({__proto__:null,init:function(a){let b;b=2===a.players?4:3===a.players?5:6;6>b&&e.all(".tower6",c=>e.hide(c));5>b&&e.all(".tower5",c=>e.hide(c));a.data[0]={towers:b}},score:function(a,b){let c=
a.data[0];if(0===b)for(b=1;b<=c.towers;b++){let d=0,f=[];for(let g=1;g<=a.players;g++){let h=a.data[g];d+=2*h["t"+b+"s"];d+=h["t"+b+"o"];f[g]=0;f[g]+=h["t"+b+"s"];f[g]+=h["t"+b+"o"]}Ca(a,b,d,f)}else for(a=a.data[b],a.score=0,a.score+=a.prestige,a.score+=Math.floor(a.leftover/5),b=1;b<=c.towers;b++)a.score+=a["t"+b+"p"]}}),rb=Object.freeze({__proto__:null,init:function(a){e.hidden("nosolo1",1===a.players)},score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.estates,a.score+=a.stations,a.score+=
a.tracks,a.score+=a.contracts,a.score+=a.equipment,a.score+=a.chai,a.score+=a.tea/2)}}),sb=Object.freeze({__proto__:null,score:function(a,b){if(0!==b){var c=a.data[0];a=a.data[b];a.score=0;a.score+=5*a.people;a.score+=a.quarters;a.score+=Math.floor((a.energy+a.food+a.money)/10);c.variant1?(a.score-=a.loans,a.score+=a.actions):(a.score-=3*a.loans,a.score+=3*a.actions);c.variant2?(a.score+=2*a.xenergy,a.score+=2*a.xfood):(a.score+=a.xenergy,a.score+=a.xfood)}}}),tb=Object.freeze({__proto__:null,score:function(a,
b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.colony,a.score+=a.statue,a.score+=a.silver,a.score+=a.gold,a.score+=a.card,a.score+=a.purple,a.score+=a.coins/5)}}),ub=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=5*a.books,a.score+=a.ship1,a.score+=a.ship2,a.score-=a.anchors,a.score+=a.royal,a.score+=a.building,a.score+=Math.floor((a.coins+a.resources+a.cartographer+a.landscape)/5))}}),vb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],
a.score=0,a.score+=a.research,a.score+=a.temple,a.score+=3*a.idol,a.score+=a.slot,a.score+=5*a.guardian,a.score+=a.artifact,a.score+=a.item,a.score-=a.fearc,a.score-=2*a.feart)}}),wb=Object.freeze({__proto__:null,score:function(a,b){0!==b&&(a=a.data[b],a.score=0,a.score+=a.tech1,a.score+=2*a.tech2,a.score+=3*a.tech3,a.score+=a.tech4,a.score+=a.automation,a.score+=a.colony,a.score+=a.outposts,a.sol&&a.score++,a.space&&a.score++,a.score+=a.event,a.score+=a.achievement)}});const xb=[0,1,2,3,4,4,5,5,
6,6,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15],yb=[0,0,0,-1,-2,-3,-5,-7,-9,-12,-15,-18],zb=[-10,-6,-3,-1,0,1,3,6,10,15];var Ab=Object.freeze({__proto__:null,init:function(a){J.subscribe("change",Da);e.all(".fireland",b=>e.hidden(b,!0))},score:function(a,b){let c=a.data[0];0===b?(c.museum=2,c.reptile&&c.museum++,c.fossil&&c.museum++,c.bird&&c.museum++,c.plant&&c.museum++):(a=a.data[b],b=xb[a.track],a.book&&b++,a.score=0,a.score+=a.board,a.score+=c.museum*b,a.score+=a.objective,
a.score+=a.worker,a.tent&&(a.score+=5),a.score+=a.knowledge,a.score+=Math.floor(a.money/5),c.fireland&&(a.score+=yb[a.time],a.score+=zb[Math.min(a.adventure,9)]))}}),Bb=Object.freeze({__proto__:null,init:function(a){for(let b=1;b<=a.players;b++)e.on("cards"+b,"change",Ea)},score:function(a,b){if(0===b)Fa(a);else{var c=a.data[0];a=a.data[b];a.score=0;a.sovereign&&(a.score+=10);a.score+=a.fleet;a.score+=3*a.helium;a.score+=a.influence*c.ivp[a.influence];7<a.cards&&(a.score-=10*(a.cards-7));for(c=1;c<=
a.cards;c++)a.score+=a["card"+c]}}}),Cb=Object.freeze({__proto__:null,init:function(a){if(!a.data[0]){var b=["A","B","C","D","E"];Ga(b);b.pop();b=b.map(c=>c+(.5>Math.random()?"1":"2"));a.data[0]={tracks:b,value1:0,value2:0,value3:0,value4:0}}a=a.data[0];for(b=1;4>=b;b++)e.text("track"+b,a.tracks[b-1])},score:function(a,b){if(0!==b){var c=a.data[0];a=a.data[b];a.score=0;a.score+=a.money;a.score+=a.shares1*c.value1;a.score+=a.shares2*c.value2;a.score+=a.shares3*c.value3;a.score+=a.shares4*c.value4;
a.score+=a.helium;a.score+=a.research;a.score+=a.bonus}}});const y={"00000050":Object.assign({name:{en:"Lost Cities",fr:"Les Cit\u00e9s Perdues"},players:{max:2,min:2},score:{en:"Score",fr:"Score"}},Va),"00031260":Object.assign({name:{en:"Agricola",fr:"Agricola"},players:{max:5,min:1},tie:{en:"building resources left",fr:"ressources de construction restantes"}},cb),"00035677":Object.assign({name:{en:"Le Havre",fr:"Le Havre"},players:{max:5,min:1}},db),"00068448":Object.assign({name:{en:"7 Wonders",
fr:"7 Wonders"},players:{max:7,min:2},tie:{en:"number of coins",fr:"nombre de pi\u00e8ces"}},eb),"00124361":Object.assign({name:{en:"Concordia",fr:"Concordia"},players:{max:5,min:2},tie:{en:'player with the "Pr&aelig;fectus Magnus" card or whoever would have received it next',fr:'joueur ayant la carte "Pr&aelig;fectus Magnus" ou bien le prochain qui l\'aurait re\u00e7cu'}},fb),"00164928":Object.assign({name:{en:"Orl\u00e9ans",fr:"Orl\u00e9ans"},players:{max:5,min:2},tie:{en:"development level",fr:"niveau de d\u00e9veloppement"}},
gb),"00169786":Object.assign({name:{en:"Scythe",fr:"Scythe"},players:{max:7,min:1},tie:{en:"number of workers, mechs and structures then power then popularity then number of resources then number of territories then number of stars",fr:"nombre d'ouvriers, mechs et b\u00e2timents puis puissance puis popularit\u00e9 puis nombre de ressources puis nombre de territoires puis nombre d'\u00e9toiles"}},hb),"00177478":Object.assign({name:{en:"IKI",fr:"IKI"},players:{max:4,min:2},tie:{en:"firefighting level",
fr:"niveau de lutte contre les incendies"}},kb),"00185343":Object.assign({name:{en:"Anachrony",fr:"Anachrony"},players:{max:4,min:1},tie:{en:"water then resources",fr:"eau puis ressources"}},lb),"00193738":Object.assign({name:{en:"Great Western Trail",fr:"Great Western"},players:{max:4,min:2}},mb),"00215471":Object.assign({name:{en:"Wind the Film!",fr:"Photograph"},players:{max:4,min:2},tie:{en:"number of good shots then longest filmstrip",fr:"nombre de clich\u00e9s r\u00e9ussis puis album le plus long"}},
ob),"00216132":Object.assign({name:{en:"Clans of Caledonia",fr:"Clans of Caledonia"},players:{max:4,min:1},tie:{en:"leftover money (included here as decimal part)",fr:"argent restant (inclus ici comme partie d\u00e9cimale)"}},pb),"00227224":Object.assign({name:{en:"The Red Cathedral",fr:"La Cath\u00e9drale Rouge"},players:{max:4,min:2},score:{en:"Prestige Points",fr:"Points de prestige"},tie:{en:"number of completed sections then number of ornaments",fr:"nommbre de sections compl\u00e9t\u00e9es puis nommbre d'ornements"}},
qb),"00228959":Object.assign({name:{en:"Alubari",fr:"Alubari"},players:{max:5,min:1}},rb),"00258389":Object.assign({name:{en:"Futuropia",fr:"Futuropia"},players:{max:4,min:1}},sb),"00269144":Object.assign({name:{en:"Hadara",fr:"Hadara"},players:{max:5,min:2},tie:{en:"leftover coins (included here as decimal part)",fr:"pi\u00e8ces restantes (inclus ici comme partie d\u00e9cimale)"}},tb),"00269511":Object.assign({name:{en:"Cooper Island",fr:"Cooper Island"},players:{max:4,min:2},tie:{en:"least number of uncharted spaces",
fr:"le moins d'espaces non cartographi\u00e9s"}},ub),"00312484":Object.assign({name:{en:"Lost Ruins of Arnak",fr:"Les Ruines Perdues de Narak"},players:{max:4,min:1},tie:{en:"the player who reached the Lost Temple first or, if nobody reached it, the player with the highest research score",fr:"le premier joueur \u00e0 avoir atteint le Temple Perdu ou, si personne ne l'a atteint, celui avec le meilleur score de recherche"}},vb),"00317985":Object.assign({name:{en:"Beyond the Sun",fr:"Beyond the Sun"},
players:{max:4,min:2},tie:{en:"fewest remaining (food and ore) production discs, then most remaining population, then most ore",fr:"le moins de disques de production restants (nourriture et minerai), puis le plus de population restante, puis le plus de minerai"}},wb),"00322289":Object.assign({name:{en:"Darwin's Journey",fr:"Darwin's Journey"},players:{max:4,min:1},tie:{en:"Theory of Evolution track position, then leftover money",fr:"position sur la piste Th\u00e9orie de l\u2019\u00c9volution, puis argent restant"}},
Ab),"00329465":Object.assign({name:{en:"Red Rising",fr:"Red Rising"},players:{max:6,min:2},tie:{en:"the player with the Sovereign token wins",fr:"le joueur avec le jeton de souverainet\u00e9 gagne"}},Bb),"00359438":Object.assign({name:{en:"Skymines",fr:"Skymines"},players:{max:4,min:1},score:{en:"CrypCoins",fr:"CrypCoins"}},Cb)},ma={debug:!1,language:"",names:"",players:0};let l={data:[],debug:!1,game:"",language:"en",names:[],players:0};const Db={setup:function(a){n.storage2state(n.GAME_STORAGE,
l);B.setup(ma);B.parse();for(const b in ma){let c=B.get(b);c&&(l[b]="names"===b?c.split(","):c)}l.debug&&u.setup("all");l.game=a;y[a].init&&y[a].init(l);for(a=0;a<=l.players;a++)l.data[a]||(l.data[a]=Ia(a));Ha();n.state2storage(n.GAME_STORAGE,l);u.log("state",l);Na();J.ready()}},na={debug:!1,game:"",language:"",players:0,forget:"",sw:0},K=["en","fr"];let k={debug:!1,game:"00164928",known:[],language:"en",names:[],players:4};const Eb={setup:function(){n.storage2state(n.HOME_STORAGE,k);B.setup(na);
B.parse();for(var a in na){let d=B.get(a);if("game"!==a||d in y)"language"===a&&0>K.indexOf(d)||("forget"===a?Oa(ja(d)):d&&(k[a]=d))}k.debug&&u.setup("all");a=e.get("language");a.value=k.language;n.language2ui(k.language);for(var b of K)a=e.get("game-"+b),a.value=k.game;ka();a=e.get("players");a.value=k.players;W();for(b=1;7>=b;b++)k.names[b-1]&&(a=e.get("player"+b),a.value=k.names[b-1]);a=e.get("known");for(var c of k.known)e.append(a,e.create("option",{value:c}));n.state2storage(n.HOME_STORAGE,
k);u.log("state",k);e.on("language","change",Pa);for(const d of K)e.on("game-"+d,"change",Qa,d);e.on("players","change",Ra);for(c=1;7>=c;c++)e.on("player"+c,"change",Sa,c),e.on("player"+c,"keydown",n.enter2tab),e.on("player"+c,"focus",n.focus2select);e.on("clear","click",Ta);e.on("next","click",Ua);console.log("setup home")}};(function(){let a=location.pathname.match(/\/(\d{8})\.html$/);a?Db.setup(a[1]):Eb.setup()})()});
